!function(){var e,n,t,r,i,a,s,u,l,o,c,f,p,h,v,g,m,y,w,b,d,x,k=[].slice;e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-+*/%^_$<>=?!";c=function(e,n){throw new SyntaxError(""+n+" at "+e.file+":"+e.line+":"+e.character)};u=function(e){return e[e.length-1]};m=function(){var n,t,r,i;i={"(":"group start",")":"group end","{":"funject start","}":"funject end","[":"list start",",":"list delimiter","]":"list end",":":"pattern match","=":"strict assignment",":=":"lazy assignment","|=":"reset strict assignment","|:=":"reset lazy assignment","<-":"inverse assignment","<<":"inheritance assignment","::":"prototypal application"};r=function(e){return e===" "||e==="	"};n=function(e){return-1!=="0123456789".indexOf(e)};t=function(n){return-1!==e.indexOf(n)};return function(e,a,s){var l,o,f,p,h,v,g,m,y,w,b,d,x,S,j,N,M,O,q,E;if(a==null){a="<anonymous>"}if(s==null){s=1}q=function(e,n){if(n==null){n=""}return{type:e,value:n,line:d,file:a,character:h}};O=function(e){throw new SyntaxError(""+e+" at "+a+":"+d+":"+h)};N="";g=0;while(true){y=e.indexOf("#",g);if(y===-1){break}N+=e.substring(g,y);g=y+1;p=e[g];if(p==="|"){++g;M=g;S=1;while(S){l=e.indexOf("#|",g);f=e.indexOf("|#",g);if(l===-1&&f===-1){throw new SyntaxError("Unmatched multiline comment")}if(l!==-1&&(l<f||f===-1)){++S;g=l+2}if(f!==-1&&(f<l||l===-1)){--S;g=f+2}}N+=Array(e.substring(M,g).split("\n").length).join("\n")}else{y=e.indexOf("\n",g);if(y===-1){break}g=y}}N+=e.substring(g);g=0;h=0;w=0;d=s;b=N.length;m=[""];E=[];o=function(){var e,a,s,l,o,c,v,y,x;if(E.length){return E.shift()}p=N[g];while(r(p)){++g;p=N[g]}h=1+g-w;if(g>=b){if(m.length>1){m.pop();return q("outdent")}return q("end")}if((c=N.substr(g,3))==="|:="||(c=N.substr(g,2))===":="||c==="|="||c==="<-"||c==="<<"||c==="::"){g+=c.length;return q(i[c],c)}switch(p){case"\n":case"\r":while(true){while(p==="\n"||p==="\r"){++g;++d;w=g;h=1+g-w;p=N[g]}v="";while(true){p=N[g];if(!r(p)){break}v+=p;++g}if(!(p==="\n"||p==="\r")){break}}s=u(m);l=v.length;o=s.length;switch(false){case l!==o:if(v!==s){O("Inconsistent indentation")}return q("newline");case!(l<o):while(l<o){E.push(q("outdent"));m.pop();s=u(m);o=s.length}if(p&&v!==s){O("Inconsistent indentation")}return E.shift();case!(l>o):if(s!==v.substr(0,o)){O("Inconsistent indentation")}m.push(v);return q("indent")}break;case"{":case"}":case"[":case"]":case":":case"=":case",":case"(":case")":++g;if(p==="="&&N[g]==="="){--g}else{return q(i[p],p)}}if(p==="-"){c=N[g+1];if(c==="."||n(c)){a=true}}if(a||p==="."||n(p)){x="";M=g;if(p==="-"){x+=p;++g;p=N[g]}if(n(p)){while(true){x+=p;++g;p=N[g];if(!n(p)){break}}}f=false;if(p==="."){x+=p;++g;p=N[g];if(!n(p)){--g;p=N[g];if(x!=="."){return q("number",+x.substr(0,x.length-1))}f=true}else{while(true){x+=p;++g;p=N[g];if(!n(p)){break}}}}if(!f){if(p==="e"||p==="E"){x+=p;++g;p=N[g];if(p==="+"||p==="-"){x+=p;++g;p=N[g]}if(!n(p)){h=1+g-w;O("Expected digit")}while(true){x+=p;++g;p=N[g];if(!n(p)){break}}}if(t(p)){g=M;p=N[g]}else{return q("number",+x)}}}if(p==="@"||p==="."||t(p)){y=p==="@"?"formal parameter":p==="."?"symbol":"identifier";x="";while(true){x+=p;++g;p=N[g];if(!t(p)){break}}if(x==="true"||x==="false"){return q("boolean",x==="true")}if(-1!==["nil","unknown","class","module","try","catch","finally","if","then","else"].indexOf(x)){return q(x,x)}if(y==="symbol"){if(x.length===1){h=1+g-w;O("Expected identifier")}return q(y,x.substr(1))}return q(y,x)}if(p==='"'||p==="'"){e=p;x="";++g;p=N[g];while(true){if(p===e){break}if(p==="\\"){++g;switch(p=N[g]){case'"':case"'":case"\\":x+=p;break;case"n":x+="\n";break;case"r":x+="\r";break;case"t":x+="	";break;default:h=1+g-w;O("Invalid escape sequence")}++g;p=N[g];continue}if(!p){O("Unterminated string")}x+=p;++g;p=N[g]}++g;return q("string",x)}return O("Unexpected "+p)};v=o();x=o();j=null;return{here:function(){return v},next:function(){return x},advance:function(){j=v;v=x;x=o();return j},match:function(){var e;e=1<=arguments.length?k.call(arguments,0):[];if(-1!==e.indexOf(v.type)){return this.advance()}if(j&&j.type==="outdent"&&-1!==e.indexOf("newline")){return{type:"newline",value:"",file:j.file,line:j.line,character:j.character}}return null},accept:function(){var e;e=1<=arguments.length?k.call(arguments,0):[];if(-1!==e.indexOf(v.value)){return this.advance()}return null},require:function(){var e;e=1<=arguments.length?k.call(arguments,0):[];return this.match.apply(this,e)||c(v,"Expected "+e.join(" or "))},requireValue:function(){var e;e=1<=arguments.length?k.call(arguments,0):[];return this.accept.apply(this,e)||c(v,"Expected '"+e.join("', '")+"'")}}}}();o=function(){var e,n,t,r,i,a,s,u;s={};e={"^":-7,"*":6,"/":6,"%":6,"+":5,"-":5,">":4,"<":4,">=":4,"<=":4,"==":3,"!=":3,is:3,isnt:3,and:2,or:2};n={not:2};t=function(){function e(){}e.prototype["null"]=function(){return c("Unexpected operator")};e.prototype.left=function(){return c("Unexpected value")};return e}();o=function(e,n,t){var r,i;i=m(e,n,t);while(i.match("newline")){}r=a(i);i.require("end");return r};a=function(e){var n,t,i;n=e.here();t=[];while(true){i=r(e,0,true);if(!i){break}t.push(i);if(!e.match("newline")){break}}return{file:n.file,line:n.line,character:n.character,type:"sequence",expressions:t}};r=function(n,t,i,s){var l,o,f,p,h,v,g,m,y,w,b,d,x,k,S,j,N,M,O;if(t==null){t=0}if(n.match("indent")){k=a(n);n.require("outdent");return k}if(S=n.match("class","module")){if(y=n.match("identifier")){while(true){if(N=n.match("symbol")){y={type:"application",file:N.file,line:N.line,character:N.character,funject:y,argument:N};continue}break}}if(n.accept("<")){x=r(n,0,false,true)}if(n.here().type!=="indent"){c(n.here(),"Expected indent")}o=r(n);k={type:S.type,file:S.file,line:S.line,character:S.character,body:o,parent:x};if(!y){return k}return{type:"assignment",operator:"strict assignment",file:S.file,line:S.line,character:S.character,left:y,right:k}}if(S=n.match("try")){if(n.here().type!=="indent"){c(n.here(),"Expected indent")}o=r(n);n.require("catch");O=n.require("identifier");y=n.match("identifier");if(n.here().type!=="indent"){c(n.here(),"Expected indent")}m=r(n);k={type:"try",file:S.file,line:S.line,character:S.character,body:o,"class":O,"catch":m};if(y){k.name=y}if(n.match("finally")){k["finally"]=r(n)}return k}if(S=n.match("if")){f=r(n,0,false,true);if(n.here().type!=="indent"){n.require("then")}M=r(n);if(n.match("else")){if(n.here().type!=="indent"&&!n.here().type==="if"){c(n.here(),"Expected indent")}g=r(n)}return{type:"if",file:S.file,line:S.line,character:S.character,condition:f,trueBody:M,falseBody:g}}h=u(n);if(!h){if(i){return null}else{c(n.here(),"Expected expression")}}while(true){if(N=n.match("symbol")){h={type:"application",file:N.file,line:N.line,character:N.character,funject:h,argument:N};continue}if(n.here().type==="list start"){N=n.here();h={type:"application",file:N.file,line:N.line,character:N.character,funject:h,argument:u(n)};continue}if(t<7){if(n.here().type==="identifier"){p=false;for(w in e){d=e[w];if(t<Math.abs(d)&&(N=n.accept(w))){h={type:"application",file:N.file,line:N.line,character:N.character,funject:h,argument:N};v=d<0?-1-d:d;if(b=r(n,v,true,s)){h=w==="and"||w==="or"?{type:w,file:N.file,line:N.line,character:N.character,left:h.funject,right:b}:{type:"application",file:N.file,line:N.line,character:N.character,funject:h,argument:b}}p=true;break}}if(p){continue}}if("identifier"===n.here().type&&!e[n.here().value]||-1!==["formal parameter","string","number","boolean","nil","unknown","funject start","group start","list start"].indexOf(n.here().type)){N=n.here();h={type:"application",file:N.file,line:N.line,character:N.character,funject:h,argument:r(n,7,false,s)};continue}if(N=n.match("prototypal application")){j=n.require("identifier");j.type="symbol";h={type:"application",file:N.file,line:j.line,character:j.character,funject:{type:"application",file:N.file,line:N.line,character:N.character,funject:h,argument:{type:"symbol",file:N.file,line:N.line,character:N.character,value:"instance"}},argument:j};continue}if(!s&&"indent"===n.here().type){N=n.here();h={type:"application",file:N.file,line:N.line,character:N.character,funject:h,argument:r(n)};break}}break}if(t===0&&(l=n.match("strict assignment","lazy assignment","reset strict assignment","reset lazy assignment","inverse assignment","inheritance assignment"))){if(l.type!=="inheritance assignment"&&l.type!=="inverse assignment"&&h.type!=="identifier"&&(h.type!=="application"||l.type!=="strict assignment"&&l.type!=="lazy assignment")){c(l,"Invalid left-hand side of assignment")}h={type:"assignment",operator:l.type,file:l.file,line:l.line,character:l.character,left:h,right:r(n,0,false,s)}}return h};u=function(e){var t,a,s,u;if(e.match("group start")){t=r(e);e.require("group end");return t}if(s=e.match("list start")){u=[];if(!e.match("list end")){while(true){u.push(r(e));if(e.match("list end")){break}e.require("list delimiter")}}return{file:s.file,line:s.line,character:s.character,type:"list",values:u}}if(s=e.match("funject start")){a=[];if(!e.match("funject end")){if(e.match("indent")){while(true){a.push(i(e));if(e.match("outdent")){break}e.require("newline")}e.require("funject end")}else{a.push(i(e));e.require("funject end")}}return{file:s.file,line:s.line,character:s.character,type:"funject",patterns:a}}if(e.here().type==="identifier"&&Object.prototype.hasOwnProperty.call(n,e.here().value)){s=e.advance();return{type:"application",file:s.file,line:s.line,character:s.character,funject:r(e,n[s.value]),argument:{type:"symbol",file:s.file,line:s.line,character:s.character,value:"not"}}}if(s=e.match("identifier","formal parameter","symbol","string","number","boolean","nil","unknown")){return s}};i=function(e){var n,t;n=r(e);e.require("pattern match");t=r(e);return{pattern:n,value:t}};return o}();f=function(e){var n;n=function(e){var t,r;switch(e.type){case"number":return["Token-number",e.value];case"symbol":return["Token-symbol",e.value];case"string":return["Token-string",e.value];case"boolean":return["Token-boolean",e.value];case"nil":return["Token-nil"];case"unknown":return["Token-unknown"];case"identifier":return["Token-identifier",e.value];case"formal parameter":return["Token-parameter",e.value];case"list":return["Token-list",function(){var t,i,a,s;a=e.values;s=[];for(t=0,i=a.length;t<i;t++){r=a[t];s.push(n(r))}return s}()];case"funject":return["Token-funject",function(){var r,i,a,s;a=e.patterns;s=[];for(r=0,i=a.length;r<i;r++){t=a[r];s.push([n(t.pattern),n(t.value)])}return s}()];case"sequence":return["Token-sequence",function(){var t,i,a,s;a=e.expressions;s=[];for(t=0,i=a.length;t<i;t++){r=a[t];s.push(n(r))}return s}()];case"application":return["Token-invocation",n(e.funject),n(e.argument)];case"or":case"and":return["Token-"+e.type,n(e.left),n(e.right)];case"class":case"module":if(e.parent){return["Token-"+e.type,n(e.parent),n(e.body)]}else{return["Token-"+e.type,n(e.body)]}break;case"try":if(e["finally"]){return["Token-try",n(e.body),n(e["catch"]),n(e["finally"])]}else{return["Token-try",n(e.body),n(e["catch"])]}break;case"assignment":switch(e.operator){case"strict assignment":if(e.left.type==="application"){return["Token-funject-strict-assignment",n(e.left),n(e.right)]}else{return["Token-strict-assignment",n(e.left),n(e.right)]}break;case"lazy assignment":if(e.left.type==="application"){return["Token-funject-lazy-assignment",n(e.left),n(e.right)]}else{return["Token-lazy-assignment",n(e.left),n(e.right)]}break;case"reset strict assignment":return["Token-reset-strict-assignment",n(e.left),n(e.right)];case"reset lazy assignment":return["Token-reset-lazy-assignment",n(e.left),n(e.right)];case"inheritance assignment":return["Token-funject-inheritance",n(e.left),n(e.right)];case"inverse assignment":return["Token-inverse-definition",n(e.left),n(e.right)]}}};return n(o(e))};p=function(e){var n,t,r,i;r=m(e);n="";i=[];while(true){t=r.advance();if(t.type==="end"){break}switch(t.type){case"indent":console.log(""+n+"{");i.push(n+="    ");break;case"outdent":n=n.substr(4);i.push(console.log(""+n+"}"));break;case"newline":i.push(console.log(""+n+";"));break;default:i.push(console.log(""+n+"(:"+t.line+":"+t.character+") <"+t.type+"> "+t.value))}}return i};h=function(e){var n;n=function(e,t){var r,i,a,s,u,l,o,c,f,p,h,v,g,m;if(t==null){t=""}if(e instanceof Array){if(typeof e[0]==="string"){r=e[0].replace(/^Token-/,"");if(e.length===2&&typeof e[1]!=="object"){return console.log(""+t+r+": "+e[1])}else{console.log(""+t+r);if(e[1]&&typeof e[1][0]!=="string"){f=e[1];v=[];for(a=0,l=f.length;a<l;a++){i=f[a];v.push(n(i,t+"    "))}return v}else{p=e.slice(1);g=[];for(s=0,o=p.length;s<o;s++){i=p[s];g.push(n(i,t+"    "))}return g}}}else{console.log(""+t+"pattern:");h=e.slice(0);m=[];for(u=0,c=h.length;u<c;u++){i=h[u];m.push(n(i,t+"    "))}return m}}else{return console.log(t+e)}};return n(f(e))};g=function(e){};if(typeof module!=="undefined"&&module!==null){d=exports;if(!module.parent){i=null;v=false;a=2;y=false;b=false;t=process.argv.length;while(a<t){switch(n=process.argv[a++]){case"-r":v=true;break;case"-t":y=true;break;case"-v":b=true;break;case"-e":i=process.argv[a++];break;default:i=""+require("fs").readFileSync(n);break}}if(a<t||i==null){console.error("Usage: coffee parser.coffee [ -r | -t | -v ] [ <filename> | -e <expression> ]");return}try{if(y){p(i)}else if(b||v){l=v?f:o;console.log(JSON.stringify(l(i),void 0,2))}else{h(i)}}catch(S){r=S;if(r instanceof SyntaxError){console.error(r.message)}else{throw r}}}}else{(this.Yak!=null?this.Yak:this.Yak={}).parser=d={}}x={IDENTIFIER_CHARS:e,parse:o,stringify:g,tokenizer:m,parseForRacket:f};for(s in x){w=x[s];d[s]=w}}.call(this);!function(){var e,n,t,r,i,a,u,l,o,c,f,p,h,v,g,m,y,w,b,d,x,k,S,j,N,M,O,q,E,T,C,L,I,$,F,_,z,A,B,P,U,Y,R,H,K,D,W,G,J,V,X,Q,Z,en,nn={}.hasOwnProperty,tn=function(e,n){for(var t in n){if(nn.call(n,t))e[t]=n[t]}function r(){this.constructor=e}r.prototype=n.prototype;e.prototype=new r;e.__super__=n.prototype;return e},rn=[].slice;d=typeof global!=="undefined"&&global!==null?global:this;p={};F=function(e){return e[e.length-1]};O=function(e,n){var t,r;for(t in n){r=n[t];e[t]=r}return e};x=function(e,n){var t,r,i,a;if(e.type!==n.type){return false}switch(e.type){case"list":if(e.value.length!==n.value.length){return false}for(t=i=0,a=e.length;i<a;t=++i){r=e[t];if(!x(r,n[t])){return false}}return true;case"funject":return e===n;case"number":case"boolean":case"string":case"symbol":return e.value===n.value;case"nil":case"unknown":return true}};a=function(){function e(e){this.message=e}return e}();m=function(){function e(e){this.error=e}return e}();f=function(e){tn(n,e);function n(e,n){this.message=e;this.trace=n}return n}(Error);o=function(e){tn(n,e);function n(e,t){n.__super__.constructor.call(this,"No match for "+e+" applied to "+t)}return n}(a);h=function(){function e(e,n,t){var r,i;this.parent=e;if(t==null){t=true}this.vars=Object.create(null);if(n!=null){for(r in n){i=n[r];if(t){this.vars[r]=i}else{this.set(r,i)}}}}e.prototype.get=function(e){if(Object.prototype.hasOwnProperty.call(this.vars,e)){return this.vars[e]}if(this.parent){return this.parent.get(e)}throw new a("Undefined variable "+e)};e.prototype.set=function(e,n){if(this.isProxy){return this.parent.set(e,n)}else{if(n.name==null){n.name=e}return this.vars[e]=n}};e.prototype.reset=function(e,n){if(Object.prototype.hasOwnProperty.call(this.vars,e)){return this.vars[e]=n}if(this.parent){return this.parent.reset(e,n)}throw new a("Cannot reset undefined variable "+e)};return e}();r=function(){e.prototype.type="funject";e.prototype.toString=function(){var e,n;try{n=(new i).evaluate({type:"application",funject:{type:"value",value:this},argument:{type:"symbol",value:"to-string"}});if(n.isString){return n.value}else{return this.basicToString()}}catch(t){e=t;if(e instanceof f){return this.basicToString()}else{throw e}}};e.prototype.basicToString=function(){if(this.isClass){if(this.name){return"#<class "+this.name+">"}else{return"#<class>"}}else if(this.call&&this.call.length!==0){return"#<primitive>"}else{return"#<funject>"}};e.prototype.toSource=function(e){var n,t;if(e===0){return this.basicToString()}try{t=(new i).evaluate({type:"application",funject:{type:"value",value:this},argument:{type:"symbol",value:"inspect"}});if(t.isString){return t.value}else{return this.getSource()}}catch(r){n=r;if(n instanceof f){return this.getSource(e)}else{throw n}}};e.prototype.getSource=function(e){if(e===0||this.isClass||this.call&&this.call.length!==0){return this.basicToString()}else if(!this.patterns||this.patterns.length===0){return"{}"}else{return this.basicToString()}};function e(e){var n,t;this.patterns=[];if(e){for(n in e){t=e[n];this[n]=t}}}e.prototype.methodHasArgs=function(){var e,n,t,r,i,s,u,l,o,c,f;i=this;n=null;e=function(e){if(n!=null&&n!==e){throw new a("Method cannot match both [@self] and [@self, @arg]")}return n=e};while(true){if(i.call){t=0;r=i.call.length;while(t<r){l=i.call[t++];while(l==="own"||l==="interpreter"){l=i.call[t++]}if(l instanceof Array){if(l.length===1){e(false)}if(l.length===2){e(true)}}++t}}if(i.patterns){f=i.patterns;for(o=0,c=f.length;o<c;o++){s=f[o];u=s.pattern;if(u.type==="list"&&u.values.length===1){e(false)}if(u.type==="list"&&u.values.length===2){e(true)}}}if(n!=null){return n}if(!(i=i.parent)){throw new a(""+this+" is not a method")}}};e.prototype.isKindOf=function(e){var n;n=this.instance;while(n){if(n===e.$instance){return true}n=n.parent}return false};e.prototype.isMemberOf=function(e){return this.instance===e.$instance};e.prototype.hasSymbol=function(e){var n,t,r,i,a,s,u,l;n=this;while(n){if(n.call){u=n.call;for(r=0,a=u.length;r<a;r++){t=u[r];if(t==="symbol"||t[0]==="."&&e===t.substr(1)){return true}}}if(n.patterns){l=n.patterns;for(i=0,s=l.length;i<s;i++){t=l[i];if(t.pattern.type==="formal parameter"||t.pattern.type==="symbol"&&t.pattern.value===e||t.pattern.type==="identifier"&&t.scope.get(t.pattern.value).isMemberOf($.Symbol)){return true}}}n=n.parent}return false};e.prototype.keys=function(){var e,n,t,r,i,s,l,o,f=this;r=function(e,n){var t;switch(e.type){case"list":return new u(function(){var i,a,s,u;s=e.values;u=[];for(i=0,a=s.length;i<a;i++){t=s[i];u.push(r(t,n))}return u}());case"symbol":return W(e.value);case"string":return new v(e.value);case"number":return new c(e.value);case"nil":case"unknown":return $[e.value];case"identifier":return n.get(e.value);default:throw new a(""+f+" has non-constant keys")}};i=[];if(this.patterns){o=this.patterns;for(s=0,l=o.length;s<l;s++){t=o[s];i.push(r(t.pattern,t.scope))}}if(this.call){e=0;n=this.call.length;while(e<n){t=this.call[e++];while(t==="interpreter"||t==="own"){t=this.call[e++]}if(t[0]==="."){i.push(W(t.substr(1)))}else if(t[0]==='"'){i.push(new v(t.substr(1)))}}}return new u(i)};e.prototype.keysOf=function(e){var n,t,r,i,a;t=[];a=this.keys().value;for(r=0,i=a.length;r<i;r++){n=a[r];if(n.isMemberOf(e)){t.push(n)}}return new u(t)};e.prototype.allKeys=function(){var e,n,t,r,i,a,s,l,o,c;i=[];n=this;while(n){c=n.keys().value;for(a=0,l=c.length;a<l;a++){t=c[a];e=true;for(s=0,o=i.length;s<o;s++){r=i[s];if(x(r,t)){e=false}}if(e){i.push(t)}}n=n.parent}return new u(i)};e.prototype.isObject=function(){var e,n,t,r;r=this.keys();for(n=0,t=r.length;n<t;n++){e=r[n];if(!e.isMemberOf($.Symbol)){return false}}return true};e.prototype["native"]=function(e,n){var t,r,i,a,s,u,l,o,c,f,p;if(e instanceof Array){if(e[0]==="|"){f=e.slice(1);for(u=0,o=f.length;u<o;u++){a=f[u];if(r=this["native"](a,n)){return r}}return false}r=[];if(!n.isList||e.length!==n.value.length){return false}p=n.value;for(i=l=0,c=p.length;l<c;i=++l){s=p[i];if(t=this["native"](e[i],s)){r=r.concat(t)}else{return false}}return r}if(e==="*"){return[n]}if($[e]){if(n===$[e]){return[]}else{return false}}if(typeof e==="string"){if(e[0]==="."){if(n.isSymbol&&n.value===e.substr(1)){return[]}}else if(e[0]==='"'){if(n.isString&&n.value===e.substr(1)){return[]}}else if(e[0]==="&"){if(n===E.get(e.substr(1))){return[]}}else{if(n.type===e){return[n]}}return false}};e.prototype.scan=function(e,n,t,r,i){var s,u,l,o,c,f;if(r.type==="list"){if(!(i.isList&&i.value.length===r.values.length)){return false}f=r.values;for(s=o=0,c=f.length;o<c;s=++o){l=f[s];if(!(u=this.scan(e,n,t,l,i.value[s]))){return false}}return true}if(r.type==="formal parameter"){if(Object.prototype.hasOwnProperty.call(n,r.value)){return x(n[r.value],i)}n[r.value]=i;return true}if(r.type==="identifier"){return x(i,e.get(r.value))}if(r.type==="application"){t.push({funject:r.funject,argument:r.argument,value:i});return true}if(r.type==="number"||r.type==="symbol"||r.type==="string"||r.type==="boolean"){return r.type===i.type&&r.value===i.value&&true}if(r.type==="nil"||r.type==="unknown"){return r.type===i.type&&true}throw new a("Invalid pattern")};e.prototype.match=function(e,n,t,r){var i,s,u,l,o,c,f,p;if(t.type==="list"){s={};p=t.values;for(u=c=0,f=p.length;c<f;u=++c){o=p[u];if(!(l=this.match(e,n,o,r.value[u]))){return false}O(s,l)}return s}if(t.type==="application"){i=e.first().value[e.frame.arg++];if(!i.isList){throw new a("Invalid inverse")}if(!i.value.length){return false}return this.bind(i.value[0],t,{},n)}return{}};e.prototype.bind=function(e,n,t,r){var i,a,s,u;if(n.type==="list"){u=n.values;for(a=0,s=u.length;a<s;a++){i=u[a];this.bind(e,i,t,r)}}else if(n.type==="formal parameter"){if(!Object.prototype.hasOwnProperty.call(r,n.value)){t[n.value]=e}}else if(n.type==="application"){this.bind(e,n.argument,t,r)}return t};e.prototype.substitute=function(e,n){var t;if(n.type==="list"){return new u(function(){var r,i,a,s;a=n.values;s=[];for(r=0,i=a.length;r<i;r++){t=a[r];s.push(this.substitute(e,t))}return s}.call(this))}if(n.type==="number"){return new c(n.value)}if(n.type==="string"){return new v(n.value)}if(n.type==="symbol"){return W(n.value)}if(n.type==="formal parameter"){if(Object.prototype.hasOwnProperty.call(e,n.value)){return e[n.value]}return $.unknown}if(n.type==="application"){throw new a("Nested applications are unimplemented")}if(n.type==="boolean"||n.type==="nil"||n.type==="unknown"){return $[n.value]}};e.prototype.apply=function(n,t,r,i,s){var l,c,f,v,g,m,y,w,b,d,x,k,S,j,N,M,q,E,T,C,L,I,$;if(s==null){s=true}if(this.call){w=0;b=this.call.length;while(w<b){S=this.call[w++];if(j=S==="interpreter"){S=this.call[w++]}if(N=S==="own"){S=this.call[w++]}E=this.call[w++];if(v=this["native"](S,r)){if(N){v.unshift(t)}if(j){v.unshift(n)}if(p===(M=E.apply(this,v))){return}return n["return"](M)}}}if(this.patterns){f=(L=n.frame.arg)!=null?L:0;x=(I=n.frame.index)!=null?I:0;$=this.patterns.slice(x);for(w=T=0,C=$.length;T<C;w=++T){k=$[w];c=[];if(n.frame.bindings){g=n.frame.bindings;c=n.frame.applications;delete n.frame.applications;delete n.frame.bindings}else{g={};if(!this.scan(k.scope,g,c,k.pattern,r)){continue}}if(c.length){if(n.frame.step==="match"){if(!(m=this.match(n,g,k.pattern,r))){delete n.frame.step;continue}O(g,m)}else if(n.frame.step==="inverse"){d=n.frame.expression;n.pop();n.stack.push({expression:{line:d.line,character:d.character,type:"reapply funject","private":i,funject:this,argument:r,own:t,instance:s},arguments:[],step:"match",applications:c,bindings:g,arg:f,index:x+w});n.push({line:k.pattern.line,character:k.pattern.character,type:"list",values:function(){var e,t,r,i;r=n.first().value;i=[];for(w=e=0,t=r.length;e<t;w=++e){l=r[w];if(!l.inverse){throw new a(""+l+" has no inverse")}i.push({type:"application",funject:{type:"value",value:l.inverse},argument:{type:"value",value:new u([c[w].value,this.substitute(g,c[w].argument)])}})}return i}.call(this)});return}else{d=n.frame.expression;n.pop();n.stack.push({expression:{line:d.line,character:d.character,type:"reapply funject","private":i,funject:this,argument:r,own:t,instance:s},arguments:[],step:"inverse",applications:c,bindings:g,arg:f,index:x+w});n.push({line:k.pattern.line,character:k.pattern.character,type:"list",values:function(){var e,n,t;t=[];for(e=0,n=c.length;e<n;e++){l=c[e];t.push(l.funject)}return t}()});return}}if(k.value){return n["return"](k.value)}else{n.pop();q=n.scope;g.own=t;if(i){g["private"]=i}n.scope=new h(k.scope,g,true);n.push({type:"set scope",scope:q});n.push(k.expression)}return}}if(s&&r.isSymbol&&this.instance&&this.instance.hasSymbol(r.value)){y=n.frame.expression;n.pop();n.pop();n.push({type:"native",value:function(){var n,i,a;i=this.first();if(i.name==null){i.name="instance."+r.value}if(i.expression){((a=this.frame).expression!=null?(a=this.frame).expression:a.expression={}).file=i.expression.file;this.frame.expression.line=i.expression.line;this.frame.expression.character=i.expression.character}n=i.methodHasArgs();this.callStack.pop();if(n){return this["return"](new e({call:["interpreter","*",function(n,r){n.pop();n.push({type:"application",file:y!=null?y.file:void 0,line:y!=null?y.line:void 0,character:y!=null?y.character:void 0,"private":t["private"]!=null?t["private"]:t["private"]=new e,funject:{type:"value",value:i},argument:{type:"value",value:new u([t,r])}});return p}]}))}else{this.pop();return this.push({type:"application",file:y!=null?y.file:void 0,line:y!=null?y.line:void 0,character:y!=null?y.character:void 0,"private":t["private"]!=null?t["private"]:t["private"]=new e,funject:{type:"value",value:i},argument:{type:"value",value:new u([t])}})}}});n.push({type:"application",file:y!=null?y.file:void 0,line:y!=null?y.line:void 0,character:y!=null?y.character:void 0,funject:{type:"value",value:this.instance},argument:{type:"value",value:r},instance:false});return}if(this.parent&&this.parent!==this){return this.parent.apply(n,t,r,i,s)}n.callStack.pop();throw new o(t,r)};e.bridge=function(n,t){var r;if(t==null){t=d}if(n==null){return $.nil}if(n instanceof Array){return new u(function(){var t,i,a;a=[];for(t=0,i=n.length;t<i;t++){r=n[t];a.push(e.bridge(r))}return a}())}switch(typeof n){case"number":return new c(n);case"string":return new v(n);case"boolean":return $[n];case"function":return new e({call:["list",function(r){return e.bridge(n.apply(t,e.unbridge(r)))},"symbol",function(t){return e.bridge(n[t.value],n)}]});case"object":return new e({call:["symbol",function(t){return e.bridge(n[t.value],n)}]})}};e.unbridge=function(n){var t,r,s,u,l,o,c,f,p,h,v;switch(n.type){case"nil":return null;case"unknown":throw new a("Cannot unbridge "+n.type);break;case"number":case"string":case"boolean":return n.value;case"symbol":throw new a("Cannot unbridge symbols");break;case"list":p=n.value;v=[];for(l=0,c=p.length;l<c;l++){u=p[l];v.push(e.unbridge(u))}return v;break;case"funject":if(n.isObject()){t=new i;s={};h=n.keysOf($.Symbol).value;for(o=0,f=h.length;o<f;o++){r=h[o];s[r.value]=e.unbridge(t.evaluate({type:"application",funject:{type:"value",value:n},argument:{type:"symbol",value:r.value}}))}return s}else{return function(){return e.unbridge((new i).evaluate({type:"application",funject:{type:"value",value:n},argument:{type:"value",value:e.bridge([].slice.call(arguments))}}))}}}};return e}();D=function(e,n,t){var i,a,s,u;if(t==null){t=r}i=[];if(n){u=function(e){return i.push("."+a,function(){return e})};for(a in n){s=n[a];u(s)}}return new t({call:i,parent:e})};K=function(e,n){return new r({call:[e,n]})};H=function(e,n,i){var a,s,l,o,c,f,p,h;p=i!=null?i:{},s=p.exports,l=p.instance,f=p._instance;o=f!=null?f:D(n!=null?n.$instance:void 0,l);o.isInstance=true;c=D(n,s!=null?s:{},t);if(n==null){delete c.parent}c.$instance=o;c.$super=n;c.$subclasses=new u([]);if(n){n.$subclasses.value.push(c)}c.instance=((h=$.Class)!=null?h:c).$instance;c.name=e;a="to-"+e.toLowerCase();(c.call!=null?c.call:c.call=[]).unshift("interpreter",["*"],function(e,n){return{lazy:{type:"application",funject:{type:"value",value:n},argument:{type:"symbol",value:a}}}});c.inverse=new r({call:[["*",["unknown"]],function(e){var n;n=e.instance;while(n){if(n===o){return new u([e])}n=n.parent}return new u([])}]});$[e]=c;return c};R=function(e){return $[!!e]};W=function(e){if(Object.prototype.hasOwnProperty.call(g.instances,e)){return g.instances[e]}else{return g.instances[e]=new g(e)}};$={};e=D(null,{initialize:K(["*"],function(e){return $.nil}),"append!":K(["*",["*","*"]],function(e,n,t){(e.patterns!=null?e.patterns:e.patterns=[]).push({pattern:{type:"identifier",value:"k"},scope:new h(null,{k:n}),value:t});return $.nil}),"insert!":K(["*",["number","*","*"]],function(e,n,t,r){n=n.value;if(n<0){n=e.patterns?e.patterns.length+n:n}if(n%1!==0||n<0||(e.patterns?n>e.patterns.length:n>0)){throw new a("Cannot insert at "+n)}(e.patterns!=null?e.patterns:e.patterns=[]).splice(n,0,{pattern:{type:"identifier",value:"k"},scope:new h(null,{k:t}),value:r});return $.nil}),clone:K(["*"],function(e){return new r({parent:e})}),name:K(["*"],function(e){if(e.name){return new v(e.name)}else{return $.nil}}),apply:new r({call:["interpreter",["*",["*"]],function(e,n,t){e.pop();e.push({type:"application",funject:{type:"value",value:n},argument:{type:"value",value:t}});return p}]}),on:new r({call:["interpreter",["*","*"],function(e,n,t){e.pop();e.push({type:"application",funject:{type:"value",value:t},argument:{type:"value",value:n}});return p}]}),then:new r({call:["interpreter",["*",["*"]],function(e,n,t){e.pop();e.push({type:"application",funject:{type:"value",value:t},argument:{type:"value",value:n}});return p}]}),is:K(["*","*"],function(e,n){return R(e===n)}),isnt:K(["*","*"],function(e,n){return R(e!==n)}),"==":K(["*","*"],function(e,n){return R(x(e,n))}),"!=":K(["*","*"],function(e,n){return R(!x(e,n))}),"symbol?":K(["*"],function(e){return R(e.isSymbol)}),"string?":K(["*"],function(e){return R(e.isString)}),"number?":K(["*"],function(e){return R(e.isNumber)}),"list?":K(["*"],function(e){return R(e.isList)}),"boolean?":K(["*"],function(e){return R(e.isBoolean)}),"nil?":K(["*"],function(e){return R(e.isNil)}),"unknown?":K(["*"],function(e){return R(e.isUnknown)}),"class?":K(["*"],function(e){return R(e.isClass)}),"integer?":K(["*"],function(e){return R(e.isNumber&&e.isInteger())}),"float?":K(["*"],function(e){return R(e.isNumber&&e.isFloat())}),"is-member-of?":K(["*",["class"]],function(e,n){return R(e.isMemberOf(n))}),"is-kind-of?":K(["*",["class"]],function(e,n){return R(e.isKindOf(n))}),"to-string":K(["*"],function(e){if(e.type==="funject"||e.type==="class"){return new v(r.prototype.basicToString.call(e))}else{return new v(""+e)}}),"to-symbol":K(["*"],function(e){return W(e+"")}),"to-boolean":K(["*"],function(e){return R(e!==$.nil&&e!==$.unknown&&e!==$["false"])}),"to-number":K(["*"],function(e){var n;n=e+"";if(+n!==+n){throw new a("Cannot convert "+e+" to a number")}return new c(+n)}),"to-error":new r({call:["interpreter",["*"],function(e,n){return e.createError(""+n)}]}),inspect:K(["*"],function(e){if(e.type==="funject"||e.type==="class"){return new v(e.getSource(-1))}else{return new v(e.toSource())}}),"has?":K(["*",["*"]],function(e,n){var t,r,i,a;a=e.keys().value;for(r=0,i=a.length;r<i;r++){t=a[r];if(x(t,n)){return $["true"]}}return $["false"]}),keys:K(["*"],function(e){return e.keys()}),"keys-of":K(["*",["class"]],function(e,n){return e.keysOf(n)}),"all-keys":K(["*"],function(e){return e.allKeys()}),each:new r({call:["interpreter",["funject",["funject"]],function(e,n,t){var r,i,a,s;s=function(){return e.push({type:"application",funject:{type:"value",value:t},argument:{type:"list",values:[{type:"value",value:a[i]},{type:"application",funject:{type:"value",value:n},argument:{type:"value",value:a[i]}}]}})};i=0;a=n.keys().value;r=a.length;if(r===0){return $.nil}e.pop();e.push({type:"native",value:function(){++i;if(i===r){return this["return"](new u(this.frame["arguments"]))}return s()}});s();return p}]})});r.prototype.instance=e;e.instance=null;t=function(e){tn(n,e);function n(){Z=n.__super__.constructor.apply(this,arguments);return Z}n.prototype.type="class";n.prototype.isClass=true;n.prototype.create=function(){return new r({instance:this.$instance})};return n}(r);u=function(e){tn(n,e);n.prototype.type="list";n.prototype.isList=true;n.prototype.copy=function(){return new n(this.value)};function n(e){this.value=e}n.prototype.toString=function(){return"["+this.value.join(", ")+"]"};n.prototype.toSource=function(e){var n;return"["+function(){var t,r,i,a;
i=this.value;a=[];for(t=0,r=i.length;t<r;t++){n=i[t];a.push(n.toSource(e-1))}return a}.call(this).join(", ")+"]"};n.prototype.call=["own",["number"],function(e,n){var t;t=n.value<0?e.value.length+n.value:n.value;if(t<0||t>=e.value.length){throw new a("Cannot access "+e+" at "+n)}return e.value[t]},".class",function(){return $.List}];return n}(r);H("Class",null,{instance:{superclass:K(["class"],function(e){var n;return(n=e.$super)!=null?n:$.nil}),subclasses:K(["class"],function(e){return e.$subclasses.copy()}),instance:K(["class"],function(e){return e.$instance}),methods:K(["class"],function(e){return e.$instance.keysOf($.Symbol)}),"all-methods":K(["class"],function(e){return e.$instance.allKeys(true)})}});t.prototype.parent=D(null,{"class":$.Class});t.prototype.instance=$.Class.$instance;$.Class.$instance.parent=e;H("Funject",null,{_instance:e});$.Class.$super=$.Funject;$.Funject.$subclasses.value.push($.Class);r.prototype.parent=D(null,{"class":$.Funject});H("Symbol",$.Funject,{instance:{}});H("String",$.Funject,{instance:{initialize:K(["string",["string"]],function(e,n){if(e.value!=null){throw new a(""+e+" is immutable")}return e.value=n.value}),length:K(["string"],function(e){return new c(e.value.length)}),"+":new r({call:[["string","string"],function(e,n){return new v(e.value+n.value)}],inverse:new r({call:[["string",["unknown","string"]],function(e,n){if(n.value!==e.value.slice(-n.value.length)){return new u([])}else{return new u([new v(e.value.slice(0,-n.value.length))])}},["string",["string","unknown"]],function(e,n){if(n.value!==e.value.slice(0,n.value.length)){return new u([])}else{return new u([new v(e.value.slice(n.value.length))])}}]})}),"*":K(["string","number"],function(e,n){return e.repeat(n)}),"contains?":K(["string",["string"]],function(e,n){return R(-1!==e.value.indexOf(n.value))}),replace:K(["string",["string","string"]],function(e,n,t){return new v(e.value.split(n.value).join(t.value))}),"replace-first":K(["string",["string","string"]],function(e,n,t){return new v(e.value.replace(n.value,t.value))})}});C=new r({call:[["number",["unknown"]],function(e){if(e.isInteger()){return new u([e])}else{return new u([])}}]});H("Number",$.Funject,{exports:{random:new r({call:[[],function(){return new c(Math.random())},["number"],function(e){if(!e.isInteger()){throw new a("Cannot generate random["+e+"]")}return new c(Math.floor(Math.random()*e.value))},["number","number"],function(e,n){if(!e.isInteger()||!n.isInteger()||n.value<=e.value){throw new a("Cannot generate random["+e+", "+n+"]")}return new c(e.value+Math.floor(Math.random()*(n.value-e.value)))}]})},instance:{"degrees-to-radians":K(["number"],function(e){return new c(e.value*Math.PI/180)}),"radians-to-degrees":K(["number"],function(e){return new c(e.value*180/Math.PI)}),max:K(["number",["number"]],function(e,n){return new c(e.value>n.value?e.value:n.value)}),min:K(["number",["number"]],function(e,n){return new c(e.value<n.value?e.value:n.value)}),sqrt:K(["number"],function(e){if(e.value<0){throw new a("Cannot compute "+e+".sqrt")}return new c(Math.sqrt(e.value))}),root:K(["number",["number"]],function(e,n){return new c(Math.pow(e.value,1/n.value))}),ln:K(["number"],function(e){return new c(Math.log(e.value))}),log:K(["number",["number"]],function(e,n){return new c(Math.log(e.value)/Math.log(n.value))}),sin:K(["number"],function(e){return new c(Math.sin(e.value))}),cos:K(["number"],function(e){return new c(Math.cos(e.value))}),tan:K(["number"],function(e){return new c(Math.tan(e.value))}),sec:K(["number"],function(e){return new c(1/Math.cos(e.value))}),csc:K(["number"],function(e){return new c(1/Math.sin(e.value))}),cot:K(["number"],function(e){return new c(1/Math.tan(e.value))}),asin:K(["number"],function(e){return new c(Math.asin(e.value))}),acos:K(["number"],function(e){return new c(Math.acos(e.value))}),atan:K(["number"],function(e){return new c(Math.atan(e.value))}),"atan/":K(["number",["number"]],function(e,n){return new c(Math.atan2(e.value,n.value))}),asec:K(["number"],function(e){return new c(Math.acos(1/e))}),acsc:K(["number"],function(e){return new c(Math.asin(1/e))}),acot:K(["number"],function(e){return new c(Math.atan(1/e))}),sinh:K(["number"],function(e){return new c((Math.exp(e.value)-Math.exp(-e.value))/2)}),cosh:K(["number"],function(e){return new c((Math.exp(e.value)+Math.exp(-e.value))/2)}),tanh:K(["number"],function(e){return new c((Math.exp(e.value*2)-1)/(Math.exp(e.value*2)+1))}),coth:K(["number"],function(e){return new c((Math.exp(e.value*2)+1)/(Math.exp(e.value*2)-1))}),sech:K(["number"],function(e){return new c(2/(Math.exp(e.value)+Math.exp(-e.value)))}),csch:K(["number"],function(e){return new c(2/(Math.exp(e.value)-Math.exp(-e.value)))}),asinh:K(["number"],function(e){return new c(Math.log(e.value+Math.sqrt(e.value*e.value+1)))}),acosh:K(["number"],function(e){return new c(Math.log(e.value+Math.sqrt(e.value*e.value-1)))}),atanh:K(["number"],function(e){return new c(Math.log((1+e.value)/(1-e.value))/2)}),acoth:K(["number"],function(e){return new c(Math.log((1-e.value)/(1+e.value))/2)}),asech:K(["number"],function(e){return new c(Math.log(1/e.value+Math.sqrt(1-e.value*e.value)/e.value))}),acsch:K(["number"],function(e){return new c(Math.log(1/e.value+Math.sqrt(1+e.value*e.value)/Math.abs(e.value)))}),abs:new r({call:[["number"],function(e){return new c(e.value<0?-e.value:e.value)}],inverse:new r({call:[["number",["unknown"]],function(e){return new u([new c(e.value),new c(-e.value)])}]})}),ceil:new r({call:[["number"],function(e){return new c(Math.ceil(e.value))}],inverse:C}),floor:new r({call:[["number"],function(e){return new c(Math.floor(e.value))}],inverse:C}),round:new r({call:[["number"],function(e){return new c(Math.round(e.value))}],inverse:C}),"to-fixed":new r({call:[["number",["number"]],function(e,n){if(n.value<0||n.value>20){throw new a("Cannot convert "+e+".to-fixed["+n+"]")}return new v(e.value.toFixed(n.value))}],inverse:C}),"to-pennies":new r({call:[["number"],function(e){return new c(Math.round(e.value*100))}],inverse:new r({call:[["number",["unknown"]],function(e){if(e.isInteger()){return new u([new c(Math.round(e.value)/100)])}else{return new u([])}}]})}),"to-dollars":new r({call:[["number"],function(e){return new c(Math.round(e.value)/100)}],inverse:new r({call:[["number",["unknown"]],function(e){if(e.isInteger()){return new u([new c(Math.round(e.value)/100)])}else{return new u([])}}]})}),times:new r({call:["interpreter",["number",["*"]],function(e,n,t){var r,i;if(!n.isInteger()||n.value<0){throw new a("Cannot "+n+".times[...]")}i=0;r=n.value;if(r===0){return new u([])}e.pop();e.push({type:"native",value:function(){++i;if(i===r){return this["return"](new u(this.frame["arguments"]))}return this.push({type:"application",funject:{type:"value",value:t},argument:{type:"value",value:new u([new c(i)])}})}});e.push({type:"application",funject:{type:"value",value:t},argument:{type:"value",value:new u([new c(i)])}});return p}]}),upto:K(["number",["number"]],function(e,n){var t;if(n.value<e.value){return new u([])}else{return new u(function(){var r,i,a,s;s=[];for(t=r=i=e.value,a=n.value;i<=a?r<=a:r>=a;t=i<=a?++r:--r){s.push(new c(t))}return s}())}}),downto:K(["number",["number"]],function(e,n){var t;if(n.value>e.value){return new u([])}else{return new u(function(){var r,i,a,s;s=[];for(t=r=i=e.value,a=n.value;i<=a?r<=a:r>=a;t=i<=a?++r:--r){s.push(new c(t))}return s}())}}),"+":new r({call:[["number","number"],function(e,n){return new c(e.value+n.value)}],inverse:new r({call:[["number",["|",["number","unknown"],["unknown","number"]]],function(e,n){return new u([new c(e.value-n.value)])}]})}),"-":new r({call:[["number","number"],function(e,n){return new c(e.value-n.value)}],inverse:new r({call:[["number",["number","unknown"]],function(e,n){return new u([new c(n.value-e.value)])},["number",["unknown","number"]],function(e,n){return new u([new c(e.value+n.value)])}]})}),"*":new r({call:[["number","number"],function(e,n){return new c(e.value*n.value)},["number","string"],function(e,n){return n.repeat(e)}],inverse:new r({call:[["number",["|",["number","unknown"],["unknown","number"]]],function(e,n){return new u([new c(e.value/n.value)])}]})}),"/":new r({call:[["number","number"],function(e,n){return new c(e.value/n.value)}],inverse:new r({call:[["number",["number","unknown"]],function(e,n){return new u([new c(n.value/e.value)])},["number",["unknown","number"]],function(e,n){return new u([new c(e.value*n.value)])}]})}),"%":K(["number","number"],function(e,n){var t;t=e.value%n.value;if(t<0){t+=n.value}return new c(t)}),"^":new r({call:[["number","number"],function(e,n){return new c(Math.pow(e.value,n.value))}],inverse:new r({call:[["number",["number","unknown"]],function(e,n){return new u([new c(Math.log(e.value)/Math.log(n.value))])},["number",["unknown","number"]],function(e,n){return new u([new c(Math.pow(e.value,1/n.value))])}]})}),">":K(["number","number"],function(e,n){return R(e.value>n.value)}),"<":K(["number","number"],function(e,n){return R(e.value<n.value)}),">=":K(["number","number"],function(e,n){return R(e.value>=n.value)}),"<=":K(["number","number"],function(e,n){return R(e.value<=n.value)})}});$.Number.call.unshift(".e",function(){return new c(Math.E)},".pi",function(){return new c(Math.PI)});H("List",$.Funject,{instance:{"to-list":K(["list"],function(e){return e}),"empty?":K(["list"],function(e){return R(e.value.length===0)}),length:K(["list"],function(e){return new c(e.value.length)}),length:K(["list"],function(e){return new c(e.value.length)}),"delete-at!":K(["list",["number"]],function(e,n){if(n<0){n+=e.value.length}if(n<0&&n>=e.value.length){throw new a("Cannot delete at "+n+" of "+e)}e.value.splice(n,1);return e}),"insert!":K(["list",["number","*"]],function(e,n,t){n=n.value;if(n<0){n+=e.value.length}if(n<0&&n>e.value.length){throw new a("Cannot insert at "+n+" of "+e)}e.value.splice(n,0,t);return e}),"sort!":new r({call:[["list",[]],function(e){e.value.sort(function(e,n){return(""+e).localeCompare(""+n)});return e},"interpreter",["list",["funject"]],function(e,n,t){var r,i,a;i=0;a=n.value.slice(0);r=a.length;if(r===0){return new u([])}e.pop();e.push({type:"native",value:function(){var e;++i;if(i===r){e=this.frame["arguments"];a.sort(function(n,t){return e[a.indexOf(n)]-e[a.indexOf(t)]});n.value=a;return this["return"](n)}return this.push({type:"application",funject:{type:"value",value:t},argument:{type:"value",value:new u([a[i]])}})}});e.push({type:"application",funject:{type:"value",value:t},argument:{type:"value",value:new u([a[i]])}});return p}]}),"map!":new r({call:["interpreter",["list",["funject"]],function(e,n,t){var r,i,a;i=0;a=n.value.slice(0);r=a.length;if(r===0){return n}e.pop();e.push({type:"native",value:function(){while(true){if(!this.arg(i,{type:"application",funject:{type:"value",value:t},argument:{type:"value",value:new u([a[i]])}})){return}++i;if(i===r){n.value=this.frame["arguments"];return this["return"](n)}}}});return p}]}),"filter!":new r({call:["interpreter",["list",["funject"]],function(e,n,t){var r,i,s,l;i=0;s=n.value.slice(0);r=s.length;if(r===0){return n}l=[];e.pop();e.push({type:"native",value:function(){var e;while(true){if(!this.arg(i,{type:"application",funject:{type:"value",value:t},argument:{type:"value",value:new u([s[i]])}})){return}e=this.frame["arguments"][this.frame["arguments"].length-1];if(!e.isBoolean){throw new a("Cannot filter on "+e)}if(e.value){l.push(s[i])}++i;if(i===r){return this["return"](new u(l))}}}});return p}]}),each:new r({call:["interpreter",["list",["funject"]],function(e,n,t){var r,i,a;i=0;a=n.value.slice(0);r=a.length;if(r===0){return $.nil}e.pop();e.push({type:"native",value:function(){while(true){if(!this.arg(i,{type:"application",funject:{type:"value",value:t},argument:{type:"value",value:new u([a[i]])}})){return}++i;if(i===r){return this["return"]($.nil)}}}});return p}]})}});u.prototype.instance=$.List.$instance;H("Boolean",$.Funject,{instance:{not:new r({call:[["boolean"],function(e){return R(!e.value)}],inverse:new r({call:[["boolean",["unknown"]],function(e){return new u([R(!e.value)])}]})}),and:K(["boolean","boolean"],function(e,n){return R(e.value&&n.value)}),or:K(["boolean","boolean"],function(e,n){return R(e.value||n.value)}),xor:K(["boolean","boolean"],function(e,n){return R(e.value!==n.value)})}});H("Nil",$.Funject);H("Unknown",$.Funject);H("Error",$.Funject,{exports:{"new":new r({call:["interpreter",["*"],function(e,n){return e.createError(""+n)}]})},instance:{initialize:new r({call:["interpreter",["*",["string"]],function(e,n,t){if(n.value!=null){throw new a(""+n+" is immutable")}n.value=t.value;return n.stack=e.stackTrace()}]}),inspect:K(["*"],function(e){return new v("#<Error: "+e.value+"\n"+e.stack+">")}),"to-string":K(["*"],function(e){return new v(e.value+"\n"+e.stack)}),"to-error":K(["*"],function(e){return e}),message:K(["*"],function(e){return new v(e.value)})}});g=function(e){tn(n,e);n.instances={};n.prototype.instance=$.Symbol.$instance;n.prototype.type="symbol";n.prototype.isSymbol=true;function n(e){this.value=e}n.prototype.toString=function(){return this.value};n.prototype.toSource=function(){return"."+this.value};n.prototype.call=[".class",function(){return $.Symbol}];return n}(r);v=function(e){tn(n,e);n.prototype.instance=$.String.$instance;n.prototype.type="string";n.prototype.isString=true;function n(e){this.value=e}n.prototype.call=["own",["number"],function(e,t){var r;r=t.value<0?e.value.length+t.value:t.value;if(r<0||r>=e.value.length){return $.nil}else{return new n(e.value.charAt(r))}},".class",function(){return $.String}];n.prototype.repeat=function(e){if(!e.isInteger()||e.value<0){throw new a("Cannot create "+s.toSource()+" * "+e)}return new n(Array(e.value+1).join(this.value))};n.prototype.toString=function(){return this.value};n.prototype.toSource=function(){return"'"+this.value.replace(/[\\]/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")+"'"};return n}(r);c=function(e){tn(n,e);n.prototype.instance=$.Number.$instance;n.prototype.type="number";n.prototype.isNumber=true;n.prototype.isInteger=function(){return this.value%1===0};n.prototype.isFloat=function(){return this.value%1!==0};function n(e){this.value=e}n.prototype.toString=function(){return""+this.value};n.prototype.toSource=function(){return""+this.value};n.prototype.valueOf=function(){return this.value};n.prototype.call=[".class",function(){return $.Number}];return n}(r);n=function(e){tn(n,e);n.prototype.instance=$.Boolean.$instance;n.prototype.type="boolean";n.prototype.isBoolean=true;function n(e){this.value=!!e}n.prototype.toString=function(){return""+this.value};n.prototype.toSource=function(){return""+this.value};n.prototype.call=[".class",function(){return $.Boolean}];return n}(r);$.nil=new r({instance:$.Nil.$instance,type:"nil",isNil:true,toString:function(){return"nil"},toSource:function(){return"nil"}});$.unknown=new r({instance:$.Unknown.$instance,type:"unknown",isUnknown:true,toString:function(){return"unknown"},toSource:function(){return"unknown"}});$["true"]=new n(true);$["false"]=new n(false);E=new(function(e){tn(n,e);n.prototype.name="<global scope>";function n(){n.__super__.constructor.call(this,null,$)}n.prototype.get=function(e){var t;try{return n.__super__.get.call(this,e)}catch(i){t=i;if(Object.prototype.hasOwnProperty.call(d,e)){return r.bridge(d[e])}else if(e==="require"&&typeof module!=="undefined"&&module!==null){return r.bridge(require)}else{throw t}}};return n}(h));en=["^","*","/","%","+","-","==","!=","<",">","<=",">=","is","isnt"];for(J=0,X=en.length;J<X;J++){z=en[J];E.set(z,W(z))}E.set("by",K(["symbol"],function(e){return K(["*"],function(n){return{lazy:{type:"application",funject:{type:"value",value:n},argument:{type:"value",value:e}}}})}));E.set("import",new r({call:["interpreter",["string"],function(e,n){var t,i;try{n=require("fs").readFileSync(n.value).toString()}catch(s){throw new a("Cannot import "+n)}i=A.parse(n);e.pop();t=e.scope;e.push({type:"native",value:function(){var e;e=this.scope.vars.exports;this.scope=t;return this["return"](e)}});e.scope=new h(null,{exports:new r});e.push(i);return p}]}));E.set("error",new r({call:["interpreter",["*"],function(e,n){e.pop();e.pop();e.callStack.pop();throw new a(""+n);return p}]}));E.set("throw",new r({call:["interpreter",["*"],function(e,n){var t,r;r=e.frame.expression;e.pop();t={type:"application",file:r!=null?r.file:void 0,line:r!=null?r.line:void 0,character:r!=null?r.character:void 0,funject:{type:"value",value:n},argument:{type:"symbol",value:"to-error"}};e.push({type:"native",value:function(){if(!this.args(t)){return}e.pop();e.pop();e.callStack.pop();throw new m(this.first())}});return p}]}));E.set("print",new r({call:[["*"],function(e){console.log(""+e);return $.nil}]}));E.set("debug",new r({call:[["*"],function(e){console.log(e.toSource(-1));return $.nil}]}));I=function(e){return this["return"]($[e.type])};Y=function(e){return this["return"](this.scope.get(e.value))};_=function(e){var n,t;if(!this.args(e.left)){return}n=this.first();if(!n.isBoolean){throw new a("Non-boolean applied to #"+e.type)}if(e.type==="and"?!n.value:n.value){return this["return"](R(e.type==="or"))}if(!this.args(e.left,e.right)){return}t=this.second();if(!t.isBoolean){throw new a("#"+e.type+" applied to non-boolean")}return this["return"](R(t.value))};P=function(e){return function(n){e.call(this,n);if(this.frame["arguments"].length){return this["return"](this.first())}else{return this.pop()}}};i=function(){function e(){}e.prototype.expressions={number:function(e){return this["return"](new c(e.value))},symbol:function(e){return this["return"](W(e.value))},string:function(e){return this["return"](new v(e.value))},"boolean":function(e){return this["return"]($[e.value])},nil:I,unknown:I,value:function(e){return this["return"](e.value)},"pop scope":P(function(e){return this.scope=this.scope.parent}),"set scope":P(function(e){return this.scope=e.scope}),"pop call stack":P(function(){return this.callStack.pop()}),"pop catch stack":P(function(){return this.catchStack.pop()}),"ignore arguments":function(){return this.pop()},"reapply funject":function(e){return e.funject.apply(this,e.own,e.argument,e["private"],e.instance)},"native":function(e){return e.value.call(this,e)},sequence:function(e){if(this.frame["arguments"].length===0){this.scope=new h(this.scope);this.scope.isProxy=e.isProxy;this.scope.name="<sequence>";this.scope.line=e.line;this.scope.character=e.character}if(!this.args.apply(this,e.expressions)){return}this.popScope();return this["return"](F(this.frame["arguments"]))},assignment:function(e){var n;switch(e.operator){case"inverse assignment":if(!this.args(e.left,e.right)){return}this.first().inverse=this.second();return this["return"](this.first());case"inheritance assignment":if(!this.args(e.left,e.right)){return}this.first().parent=this.second();return this["return"](this.first())}if(e.left.type==="identifier"){switch(e.operator){case"strict assignment":if(!this.args(e.right)){return}this.scope.set(e.left.value,this.first());return this["return"](this.first());case"reset strict assignment":if(!this.args(e.right)){return}this.scope.reset(e.left.value,this.first());return this["return"](this.first());case"lazy assignment":this.scope.set(e.left.value,{lazy:e.right,scope:this.scope});return this["return"]($.nil);case"reset lazy assignment":this.scope.reset(e.left.value,{lazy:e.right,scope:this.scope});return this["return"]($.nil)}}if(e.left.type==="application"){if(!this.args(e.left.funject)){return}n=this.first();if(n.isInstance&&!G.ALLOW_CLASS_REDEFINITION){throw new a("Cannot modify class definition")}if(e.operator!=="lazy assignment"&&this.frame["arguments"].length===1){this.push(e.right);return}(n.patterns!=null?n.patterns:n.patterns=[]).unshift(e.operator==="lazy assignment"?{pattern:e.left.argument,expression:e.right,scope:this.scope}:{pattern:e.left.argument,value:this.second(),scope:this.scope});return this["return"](e.operator==="lazy assignment"?$.nil:this.second())}throw new a("Unimplemented: "+e.operator)},identifier:Y,"formal parameter":Y,list:function(e){if(!this.args.apply(this,e.values)){return}return this["return"](new u(this.frame["arguments"]))},funject:function(e){var n,t;n=new r;n.expression=e;n.patterns=function(){var n,r,i,a;i=e.patterns;a=[];for(n=0,r=i.length;n<r;n++){t=i[n];a.push({pattern:t.pattern,expression:t.value,scope:this.scope})}return a}.call(this);return this["return"](n)},"if":function(e){var n,t;if(!this.args(e.condition,{type:"application",funject:{type:"value",value:this.first()},argument:{type:"symbol",value:"to-boolean"}})){return}n=this.second();if(n!==$["true"]&&n!==$["false"]){throw new a("Cannot convert "+this.first()+" to boolean")}if(!this.args(0,0,n===$["true"]?e.trueBody:(t=e.falseBody)!=null?t:{type:"nil"})){return}return this["return"](this.third())},"try":function(e){this.pop();if(e["finally"]){this.push(e["finally"]);this.push({type:"ignore arguments"})}this.catchStack.push({index:this.stack.length,callIndex:this.callStack.length,expression:e,scope:this.scope});this.push({type:"pop catch stack"});return this.push(e.body)},module:function(e){var n,t,i;i=e.parent!=null;if(i&&!this.args(e.parent)){return}n=i?1:0;if(this.frame["arguments"].length===n){this.frame["super"]=i?this.first():$.Funject;this.push({type:"pop scope"});this.scope=this.frame.scope=new h(this.scope,{exports:new r({parent:this.frame["super"]}),"super":this.frame["super"]},true);if(i){this.args(e.parent,e.body)}else{this.args(e.body)}return}t=this.frame.scope.vars.exports;t.parent=this.frame["super"];return this["return"](t)},"class":function(e){var n,i,s,l,o,c,f;if((i=this.stack[this.stack.length-2].expression)&&i.type==="assignment"&&i.left.type==="identifier"){this.frame.name=i.left.value}else{this.frame.name="<class>"}c=e.parent!=null;if(c&&!this.args(e.parent)){return}n=c?1:0;if(this.frame["arguments"].length===n){this.frame["super"]=c?this.first():$.Funject;if(!this.frame["super"].isClass){throw new a("Cannot inherit from "+this.frame["super"])}this.push({type:"pop scope"});this.scope=this.frame.scope=new h(this.scope,{exports:new t({parent:this.frame["super"],name:this.frame.name,expression:e}),"super":this.frame["super"],instance:new r({parent:this.frame["super"].$instance})},true);e.body.isProxy=true;if(c){this.args(0,e.body)}else{this.args(e.body)}return}s=this.frame.scope.vars.exports;s.parent=this.frame["super"];s.$super=this.frame["super"];s.$subclasses=new u([]);this.frame["super"].$subclasses.value.push(s);o=s.$instance=this.frame.scope.vars.instance;o.isInstance=true;o.name=""+this.frame.name+".instance";o.expression=e;o.parent=this.frame["super"].$instance;f=D(null,{"class":s});l=new r({call:["interpreter","symbol",function(e,n){var t;t=e.frame.expression;e.pop();e.push({type:"native",value:function(){var e;if(!this.args({type:"application",funject:{type:"value",value:o},argument:{type:"value",value:n}})){return}e=this.first();if(e.name==null){e.name="instance."+n.value}return this["return"](new r({call:["interpreter",["|",["*"],["*","*"]],function(n,i,a){n.pop();n.pop();n.callStack.pop();n.push({type:"application",file:t!=null?t.file:void 0,line:t!=null?t.line:void 0,character:t!=null?t.character:void 0,funject:{type:"value",value:e},argument:{type:"value",value:new u(a?[i,a]:[i])},"private":i["private"]!=null?i["private"]:i["private"]=new r});return p}]}))}});return p}]});(s.call!=null?s.call:s.call=[]).unshift(".instance",function(){return l},"interpreter",".new",function(e){var n;n=e.frame.expression;e.pop();e.pop();e.callStack.pop();e.push({type:"native",value:function(){var e,t,i,a;i={type:"application",file:n!=null?n.file:void 0,line:n!=null?n.line:void 0,character:n!=null?n.character:void 0,instance:false,funject:{type:"value",value:o},argument:{type:"symbol",value:"initialize"}};if(!this.args(i)){return}t=this.first();if(t.name==null){t.name="instance.initialize"}e=t.methodHasArgs();a=new r({parent:f,instance:o});if(e){return this["return"](new r({call:["interpreter","*",function(e,i){e.pop();e.push({type:"value",value:a});e.push({type:"application",file:n!=null?n.file:void 0,line:n!=null?n.line:void 0,character:n!=null?n.character:void 0,"private":a["private"]!=null?a["private"]:a["private"]=new r,funject:{type:"value",value:t},argument:{type:"value",value:new u([a,i])}});return p}]}))}else{this.pop();this.push({type:"value",value:a});return this.push({type:"application",file:n!=null?n.file:void 0,line:n!=null?n.line:void 0,character:n!=null?n.character:void 0,"private":a["private"]!=null?a["private"]:a["private"]=new r,funject:{type:"value",value:t},argument:{type:"value",value:new u([a])}})}}});return p});return this["return"](s)},application:function(e){var n,t,r;if(!this.args(e.funject,e.argument)){return}if(this.frame["arguments"].length>2){return this["return"](this.frame["arguments"][2])}t=this.first();n=this.second();this.stack.splice(this.stack.length-1,0,{expression:{type:"pop call stack"},arguments:[]});this.callStack.push({expression:e,name:t.name});return t.apply(this,(r=e.own)!=null?r:t,n,e["private"],e.instance)},or:_,and:_};e.prototype.load=function(e){this.scope=E;this.stack=[{arguments:[]}];this.callStack=[];this.catchStack=[];e.isProxy=true;this.push(e);return this};e.prototype.evaluate=function(e){this.load(e);while(this.stack.length>1){this.step()}return F(this.stack[0]["arguments"])};e.prototype.step=function(e){var n,t,r,i,s;if(this.stack.length===1){return true}this.frame=F(this.stack);try{this.expression()}catch(u){t=u;if(t instanceof a||t instanceof m){r=(s=t.error)!=null?s:this.createError(t.message);while(this.catchStack.length){n=this.catchStack.pop();try{i=n.scope.get(n.expression["class"].value)}catch(u){}if(i&&r.isKindOf(i)){this.stack=this.stack.slice(0,+(n.index-1)+1||9e9);this.callStack=this.callStack.slice(0,+(n.callIndex-1)+1||9e9);if(n.expression.name){this.scope=new h(n.scope);this.scope.set(n.expression.name.value,r)}else{this.scope=n.scope}this.push(n.expression["catch"]);return}}throw new f(r.value,r.value+"\n"+r.stack)}else{if(typeof require!=="undefined"&&require!==null){console.log(require("util").inspect(this.stack,{depth:5}))}throw t}}return false};e.prototype.stackTrace=function(){var e,n,t,r,i,a,s,u;i="";e=this.callStack.slice(0);e.push({expression:this.frame.expression});r=null;for(a=0,s=e.length;a<s;a++){u=e[a],n=u.expression,t=u.name;if(r){if(n.file){i="\n at "+r+" ("+n.file+":"+n.line+":"+n.character+")"+i}else{i="\n at "+r+i}}else{if(n.file){i="\n at "+n.file+":"+n.line+":"+n.character+i}else{i="\n at <anonymous>"+i}}r=t}return i.substr(1)};e.prototype.createError=function(e){var n;n=$.Error.create();n.value=e;n.stack=this.stackTrace();return n};e.prototype.value=function(){return F(this.stack[0]["arguments"])};e.prototype.arg=function(e,n){var t,r;if(e>this.frame["arguments"].length){throw new TypeError("Invalid arg(..) offset "+e)}if(e===this.frame["arguments"].length){this.push(n);return false}if((t=this.frame["arguments"][e]).lazy){this.frame["arguments"].pop();r=this.scope;this.push({type:"set scope",scope:r});this.scope=t.scope;this.push(t.lazy);return false}return true};e.prototype.args=function(){var e,n;e=1<=arguments.length?rn.call(arguments,0):[];n=this.frame["arguments"].length;if(n&&this.frame["arguments"][n-1].lazy){this.arg(n-1,e[n-1]);return false}if(n<e.length){this.push(e[n]);return false}return true};e.prototype.expression=function(){var e;e=this.frame.expression;if(this.expressions[e.type]==null){throw new Error("Invalid expression type "+e.type)}return this.expressions[e.type].call(this,e)};e.prototype["return"]=function(e){this.stack.pop();return F(this.stack)["arguments"].push(e)};e.prototype.push=function(e){return this.stack.push({expression:e,arguments:[]})};e.prototype.pop=function(){return this.stack.pop()};e.prototype.popScope=function(){return this.scope=this.scope.parent};e.prototype.first=function(e){return this.frame["arguments"][0]};e.prototype.second=function(e){return this.frame["arguments"][1]};e.prototype.third=function(e){return this.frame["arguments"][2]};return e}();S=function(e,n,t){return(new i).evaluate(A.parse(e,n,t))};l=1e3;k=function(e,n,t,r){var a,s,u,o,c,p,h,v;if(n==null){n="<anonymous>"}if(t==null){t=1}if(r==null){r=null}a=[];s=[];o=[];p=function(e,n){var t,r,i,u,l,c,f,p;for(r=0,l=a.length;r<l;r++){t=a[r];t(e,n)}if(n){for(i=0,c=s.length;i<c;i++){t=s[i];t(n)}}if(e){p=[];for(u=0,f=o.length;u<f;u++){t=o[u];p.push(t(e))}return p}};if(arguments.length===2){r=n;n="<anonymous>"}if(r){a.push(r)}try{c=(new i).load(A.parse(e,n,t));v=setTimeout(h=function(){var e,n;n=0;try{while(true){if(c.step()){p(null,c.value());return}else if(++n>=l){v=setTimeout(h);return}}}catch(t){e=t;if(e instanceof f){return p(e,null)}else{throw e}}})}catch(g){u=g;if(u instanceof SyntaxError){setTimeout(function(){return p(u,null)})}else{throw u}}return{abort:function(){clearTimeout(v);return this},then:function(e){a.push(e);return this},done:function(e){s.push(e);return this},fail:function(e){o.push(e);return this}}};U=function(){var e,n,t,r,i,a,s,u,l;r=require("readline");s=r.createInterface({input:process.stdin,output:process.stdout,completer:function(e){var n;if(/^\s*$/.test(e)){if(n=/(^|\n)([ \t]+).*\n$/.exec(t)){if(e.length>=n[2].length){return[[e+"    "],e]}else{return[[n[2]],e]}}else{return[[e+"    "],e]}}else{return[[],e]}}});e=4;i=1;u=function(n){var t;if(n==null){n=">"}t=""+i;while(t.length<e){t="0"+t}return s.setPrompt(t+n+" ")};u(">");s.prompt();t="";n=1;l=0;a=null;s.on("line",function(e){++i;l=0;if(e===""&&t===""){u(">");s.prompt();n=i;return}t+=e+"\n";if(!/^[\t ]|(^|[(\[])(class|module|try|catch|finally|if|else)\b|\[[^\]]*$|\([^)]*$|\{[^\}]*$/.test(e)){return a=k(t,"input",n,function(e,r){if(e){if(e.trace){console.log(e.trace)}else if(e.message){console.log(e.message)}}else if(r){console.log(r.toSource(3))}a=null;t="";n=i;u(">");return s.prompt()})}else{u(":");return s.prompt()}});s.on("SIGINT",function(){if(a!=null){a.abort();t=""}else{s._refreshLine();if(s.line===""&&t===""){if(l){s.close()}else{l=1;s.clearLine();console.log("(^C again to quit)")}}else{l=0;s.clearLine();t=""}}++i;n=i;u(">");return s.prompt()});return s.on("close",function(){console.log("");return process.exit(0)})};if(typeof module!=="undefined"&&module!==null){q=require("fs");B=require("path");A=require("./parser.coffee");G=exports;G.repl=U;if(!module.parent){M=[];T=2;N=1;w=process.argv.length;L=false;while(T<w){switch(y=process.argv[T++]){case"-h":console.error("Usage: coffee interpreter.coffee [ <filename> | -e <expression> | -i | -h ]");return;case"-i":L=true;break;case"--allow-class-redefinition":G.ALLOW_CLASS_REDEFINITION=true;break;case"-e":M.push({file:"expression"+N++,source:process.argv[T++]});break;default:M.push({file:B.resolve(y),source:""+q.readFileSync(y)})}}for(V=0,Q=M.length;V<Q;V++){j=M[V];try{S(j.source,j.file)}catch(an){b=an;if(b instanceof SyntaxError){console.error(b.message)}else{throw b}}}if(L||M.length===0){U()}}}else{A=Yak.parser;(this.Yak!=null?this.Yak:this.Yak={}).interpreter=G={}}G.ALLOW_CLASS_REDEFINITION=false;G["eval"]=k;G.evalSync=S}.call(this);!function(){var e,n,t,r,i,a,s,u,l,o,c,f,p,h,v,g,m,y;s=document.querySelector("header");g=document.querySelector(".header-fill");a=document.querySelectorAll("h1");f=s.firstElementChild;o=document.querySelectorAll("nav a");y=document.querySelector(".try-yak");u=document.querySelector(".interpreter");p=document.querySelector(".prompt");m=document.querySelector(".prompt textarea");c=document.querySelector(".prompt .measure");u.style.display="block";s.style.position="fixed";s.style.left="24px";s.style.right="24px";h=function(){return g.style.height=s.offsetHeight+"px"};window.addEventListener("resize",h);h();r=false;n=void 0;e={};v=function(t){var i,l,c,p,h,v,g,m;v=f.lastElementChild.offsetHeight-f.offsetHeight;h=u.offsetHeight;g=v+h;if(r){v=g}m=Math.min(0,Math.max(v,-window.scrollY));if(t===e){s.style.transition="top .3s";setTimeout(function(){return s.style.transition="none"
},300)}s.style.top=m+"px";if(n){n.className=""}y.style.display=m<=g?"block":"none";c=0;l=a[0];while(c<a.length){i=a[c].getBoundingClientRect();if(i.top>96+(r?h:0)){break}l=a[c];++c}p=l.nextElementSibling.id;c=0;while(c<o.length){if(o[c].href.split("#").pop()===p){n=o[c];break}++c}return n.className="active"};window.addEventListener("scroll",v);v();y.addEventListener("click",function(){if(!r){r=true;setTimeout(function(){return i()},300);v(e);return y.textContent="Close"}else{r=false;v(e);return y.textContent="Try Yak"}});i=function(){m.focus();return m.selectionStart=m.selectionEnd=m.value.length};if(m.getBoundingClientRect().top>=0){i()}t=function(){c.textContent=m.value+"X";return m.style.height=c.offsetHeight+"px"};m.addEventListener("input",t);t();l=function(e){var n,r,i,a,s,l,o,c;a=function(e){var t;t=r+e;m.value=t+n;return m.selectionStart=m.selectionEnd=t.length};l=function(e,n){var t;t=document.createElement("div");t.className=e;t.textContent=n;u.insertBefore(t,p);return u.scrollTop=u.scrollHeight};r=m.value.slice(0,m.selectionStart);n=m.value.slice(m.selectionStart);s=r.split("\n").pop();i=/^\s*/.exec(s)[0];switch(e.keyCode){case 13:e.preventDefault();c=/class|module|if|else|try|catch|finally|\[[^\]]*$|\([^\)]*$|\{[^\}]*$/.test(s);if(e.shiftKey||m.selectionStart!==m.selectionEnd||m.selectionStart!==m.value.length||i.length!==0||c){if(c){i+="    "}a("\n"+i)}else{l("prompt",m.value);if(m.value){Yak.interpreter["eval"](m.value,"input",1,function(e,n){var t;if(e){return l("error",(t=e.trace)!=null?t:e.message)}else if(n){return l("output",n.toSource())}});m.value=""}}return t();case 9:e.preventDefault();if(e.shiftKey){o=Math.min(s.length-Math.ceil(s.length/4-1)*4,/\s*$/.exec(r)[0].length);if(o){r=r.slice(0,-o);return a("")}}else{return a(Array(Math.floor(s.length/4+1)*4-s.length+1).join(" "))}}};m.addEventListener("keydown",l)}.call(this);Yak.interpreter.ALLOW_CLASS_REDEFINITION=true;Yak.interpreter.evalSync("Boolean.instance.not = {\n    [true]: false\n    [false]: true\n}\n\nBoolean.instance.and = {\n    [true, [@x]]: @x\n    [false, [@x]]: false\n}\n\nBoolean.instance.or = {\n    [true, [@x]]: true\n    [false, [@x]]: @x\n}\n\nBoolean.instance.xor = {\n    [@x, [@x]]: false\n    [@x, [@y]]: true\n}\n\nFunject.assoc = {\n    # @x => [[key, value], [key, value], [key, value], ...]\n    [@pairs]:\n        result = {}\n        i = 0\n        {[]: i < @pairs.length}.while-true {\n            []:\n                result[@pairs[i][0]] = @pairs[i][1]\n                i |= i + 1\n        }\n        result\n    [@keys, @values]:\n        result = {}\n        (@keys.length == @values.length).on {\n            false: error['Key and value list lengths did not match']\n        }\n        i = 0\n        {[]: i < @keys.length}.while-true {\n            []:\n                result[@keys[i]] = @values[i]\n                i |= i + 1\n        }\n        result\n}\n\nFunject.instance.while-true = {\n    [@self, @body]: {\n        true:\n            @body[]\n            @self.while-true @body\n        false: nil\n    } @self[]\n}\n\nFunject.instance.do-while-true = {\n    [@self, @body]:\n        @body[]\n        @self.while-true @body\n}\n\nFunject.instance.on = {\n    [@self, @body]: @body @self\n}\n\nFunject.instance.then = {\n    [@self, [@body]]: @body[@self]\n}\n\nFunject.instance.apply = {\n    [@self, [@body]]: @self @body\n}\n\nFunject.instance.clone = {\n    [@self]: {} << @self\n}\nassert = {\n    [true]: nil\n    [false]: error['An assertion failed']\n    [true, @message]: nil\n    [false, @message]: error['An assertion failed: ' + @message]\n}\n\nassert== = {\n    [@value, @value]: nil\n    [@value, @other]: assert[false, 'Expected ' + @value.inspect + ' but got ' + @other.inspect]\n}\n\nunreachable := error['Unreachable code executed']\n\nargumentFlag = false\n\nvim := 'Real programmers use emacs, try using \"emacs\" instead'\n\nemacs := 'Real programmers use vim, try using \"vim\" instead'\n# Needs list random access ASAP\n\nList.instance.* = {\n    [@self, @n]:\n        list = []\n        @n.times[{[@i]: list.concat![@self]}]\n        list\n}\n\nList.instance.+ = {\n    [@self, @l]:\n        @l.length.times[{[@i]: @self.push![@l[@i]]}]\n        @self\n}\n\nList.instance.empty? = {\n    [@self]: @self.length == 0\n}\n\nList.instance.clear! = {\n    [@self]:\n        {[]: @self.length > 0}.while-true {\n            []: @self.delete-at![0]\n        }\n}\n\nList.instance.set! = {\n    [@self, [@l]]:\n        @self.clear!\n        @l.length.times[{[@i]: @self.push![@l[@i]]}]\n}\n\nList.instance.contains? = {\n    [@self, [@f]]: @self.index-of[@f] == -1\n}\n\nList.instance.pop! = {\n    [@self]:\n        result = @self[@self.length - 1]\n        @self.delete-at![@self.length - 1]\n        result\n}\n\nList.instance.push! = {\n    [@self, [@f]]: @self.insert![@self.length, @f]\n}\n\nList.instance.shift! = {\n    [@self, [@f]]:\n        result = @self[0]\n        @self.delete-at![0]\n        result\n}\n\nList.instance.unshift! = {\n    [@self, [@f]]: @self.insert![0, @f]\n}\n\nList.instance.pop = {\n    [@self]: @self[@self.length - 1]\n}\n\nList.instance.index-of = {\n    [@self, [@f]]:\n        found = false\n        i = 0\n        {[]: i < @self.length and found.not}.while-true {\n            []:\n                found |= @self[i] == @f\n                i |= i + 1\n        }\n        if found.not\n            -1\n        else\n            i - 1\n}\n\nList.instance.last-index-of = {\n    [@self, [@f]]:\n        found = false\n        i = @self.length - 1\n        {[]: i >= 0 and found.not}.while-true {\n            []:\n                found |= @self[i] == @f\n                i |= i - 1\n        }\n        if found.not\n            -1\n        else\n            i + 1\n}\n\nList.instance.join = {\n    [@self, [@s]]:\n        result = ''\n        i = 1\n        {[]: i < @self.length}.while-true {\n            []:\n                result |= result + @s + @self[i].to-string\n                i |= i + 1\n        }\n        @self[0] + result\n}\n\nList.instance.pluck! = {\n    [@self, [@key]]: @self.map![by[@key]]\n}\n\nList.instance.invoke! = {\n    [@self, [@f]]: @self.map![{[@e]: (@e @f)[]}]\n}\n\nList.instance.filter! = {\n    [@self, [@f]]:\n        i = @self.length - 1\n        {[]: i >= 0}.while-true {\n            []:\n                if f[@self[i]].not\n                    @self.delete-at![i]\n                i |= i - 1\n        }\n        @self\n}\n\nList.instance.reject! = {\n    [@self, [@f]]:\n        i = @self.length - 1\n        {[]: i >= 0}.while-true {\n            []:\n                if f[@self[i]]\n                    @self.delete-at![i]\n                i |= i - 1\n        }\n        @self\n}\nNumber.e = 2.718281828459045\nNumber.pi = 3.141592653589793\nNumber.epsilon = 1.0e-12\n\nNumber.instance.abs = {\n    [@x]: {\n        true: 0 - @x\n        false: @x\n    } (@x < 0)\n}\n\nNumber.instance.negate = {\n    [@x]: 0 - @x\n}\n\nNumber.instance.factorial = {\n    [0]: 1\n    [@n]: @n * ((@n - 1).factorial)\n}\n\nNumber.instance.reciprocal = {\n    [@x]: 1 / @x\n}\n\nNumber.instance.radians-to-degrees = {\n    [@x]: (@x * 180) / Number.pi\n}\n\nNumber.instance.degrees-to-radians = {\n    [@x]: (@x * Number.pi) / 180\n}\n\nNumber.instance.sqrt = {\n    [@x]:\n        last-guess = nil\n        guess = @x / 3\n        {[]: (guess - last-guess).abs > Number.epsilon}.do-while-true {\n            []:\n                last-guess |= guess\n                guess |= (guess + (@x / guess)) / 2\n        }\n        guess\n}\n\nNumber.instance.root = {\n    [@x, [0]]: error['Out of range']\n    [@x, [@y]]: (@x.ln * @y).exp\n}\n\nNumber.instance.sin = {\n    [@x]:\n        constrained = @x % (Number.pi / 2)\n        subtract = false\n        count = 1\n        last-guess = nil\n        guess = 0\n        {[]: (guess - last-guess).abs > Number.epsilon}.do-while-true {\n            []:\n                last-guess |= guess\n                {\n                    true: guess |= guess - ((constrained ^ count) / (count.factorial))\n                    false: guess |= guess + ((constrained ^ count) / (count.factorial))\n                } subtract\n                count |= count + 2\n                subtract |= subtract.not\n        }\n        guess\n}\n\nNumber.instance.cos = {\n    [@x]: (@x + (Number.pi / 2)).sin\n}\n\nNumber.instance.tan = {\n    [@x]: (@x.sin) / (@x.cos)\n}\n\nNumber.instance.sec = {\n    [@x]: 1 / (@x.cos)\n}\n\nNumber.instance.csc = {\n    [@x]: 1 / (@x.sin)\n}\n\nNumber.instance.cot = {\n    [@x]: (@x.cos) / (@x.sin)\n}\n\nNumber.instance.atan = {\n    [@x]:\n        {\n            true: 0 - ((0 - @x).atan)\n            false:\n                # make an initial guess\n                theta = (@x * (Number.pi / 2)) / (@x + 1)\n                eps = (Number.pi / 2) * Number.epsilon\n                step = theta\n                {[]: (step * step) > eps}.while-true[{\n                    []:\n                        sin-theta = theta.sin\n                        cos-theta = theta.cos\n                        step = (sin-theta * cos-theta) - (@x * cos-theta * cos-theta)\n                        theta = theta - step\n                }]\n                theta\n        } (@x < 0)\n}\n\nNumber.instance.asin = {\n    [@x]:\n        {\n            true: error['Out of range']\n        } @x < -1.0 or @x > 1.0\n        {\n            true: (Number.pi / 2) * @x\n            false: (@x / (1.0 - (@x * @x)).sqrt).atan\n        } ((@x == -1.0) or (@x == 1.0))\n}\n\nNumber.instance.acos = {\n    [@x]: (Number.pi / 2) - (@x.asin)\n}\n\n#|\nNumber.instance.atan/ = {\n    [0, [0]]: error['Out of range']\n    [@x, [@y]]: {\n        true: (@x / @y).atan\n        false: {\n            true: (@x / @y).atan + Number.pi\n            false: {\n                {\n                    true: Number.pi / 2\n                    false: {\n                        true: 0 - (Number.pi / 2)\n                        false: unreachable\n                    } ((@x == 0) and (@y < 0))\n                } ((@x == 0) and (@y > 0))\n            } ((@x < 0) and (@y < 0))\n        } ((@x < 0) and (@y >= 0))\n    } (@x > 0)\n}\n|#\n\nNumber.instance.asec = {\n    [@x]: 1 / (@x.acos)\n}\n\nNumber.instance.acsc = {\n    [@x]: 1 / (@x.asin)\n}\n\nNumber.instance.acot = {\n    [@x]: 1 / (@x.atan)\n}\n\n#Numbee.round is primitive, and should be part of the interpreter\n\nNumber.instance.ceil = {\n    [@x]:\n        {\n            true: @x\n            false: (@x + 0.5).round\n        } ((@x % 1) == 0)\n}\n\nNumber.instance.floor = {\n    [@x]: (@x - 0.5).round\n}\n\n#exp and ln will be implemented at the primitive level\n\nNumber.instance.log10 = {\n    [@x]: (@x.ln) / (10.ln)\n}\n\nNumber.instance.log = {\n    [@x, [@y]]: (@x.ln) / (@y.ln)\n}\n\nNumber.instance.to-fixed = {\n    [@x, [@n]]:\n        f = 10 ^ @n\n        (@x * f).round / f\n}\n\n\n# Calls function repeatedly with arguments 0 through @y-1\nNumber.instance.times = {\n    [@x, [@y]]:\n        i = 0\n        {[]: i < @x}.while-true {\n            []:\n                @y[i]\n                i |= i + 1\n        }\n}\n\nNumber.instance.close-to? = {\n    [0, [@x]]: @x.abs < 0.0001\n    [@x, [0]]: @x.abs < 0.0001\n    [@x, [@y]]:\n        tolerance = @x.abs.max[@y.abs] * 0.0001\n        (@x - @y).abs <= tolerance\n}\n#assuming primitives: [<number>], [<range>], index-of, last-index-of, uppercase? lowercase?, alpha?\n\nString.watman := 'NaN'.repeat[15] + ' Batman!'\n\nString.lowercase-set = 'abcdefghijklmnopqrstuvwxyz'\n\nString.uppercase-set = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\n\nString.number-set = '0123456789'\n\nString.alphanumeric-set = String.lowercase-set + String.uppercase-set + String.number-set\n\nString.instance.contains? = {\n    [@self, [@s]]: @self.index-of[@s] != -1\n}\n\nString.instance.begins-with? = {\n    [@self, [@s]]: @self.index-of[@s] == 0\n}\n\nString.instance.ends-with? = {\n    [@self, [@s]]: @self.last-index-of[@s] == (@self.length - @s.length)\n}\n\nString.instance.index-of = {\n    [@self, [@s]]:\n        i = 0\n        streak = 0\n        streakStart = -1\n        complete = false\n        {[]: i < @self.length and streak < @s.length}.while-true {\n            []:\n                char = @self[i]\n                (char == @s[streak]).on {\n                    true:\n                        (streak == 0).on {\n                            true: streakStart |= i\n                            false: nil\n                        }\n                        streak |= streak + 1\n                    false: streak |= 0\n                }\n                i |= i + 1\n        }\n        (streak == @s.length).on {\n            true: streakStart\n            false: -1\n        }\n}\n\nString.instance.last-index-of = {\n    [@self, [@s]]:\n        (@self.contains?[@s].not).on { # For speed, do a pre-check to see if the owner contains the string\n            true: -1\n            false:\n                i = @self.length - 1\n                streak = @s.length - 1\n                streakStart = -1\n                complete = false\n                {[]: i >= 0 and streak >= 0}.while-true {\n                    []:\n                        char = @self[i]\n                        (char == @s[streak]).on {\n                            true:\n                                (streak == 0).on {\n                                    true: streakStart |= i\n                                    false: nil\n                                }\n                                streak |= streak - 1\n                            false: streak |= @s.length - 1\n                        }\n                        i |= i - 1\n                }\n                streakStart\n        }\n}\n\n# Not working due to missing push! List primitive\nString.instance.split = {\n    [@self, [@s]]:\n        result = []\n        check = @self\n        {[]: check.contains?[@s]}.while-true {\n            []:\n                next = check.substring[0, check.index-of[@s]]\n                result.push![next]\n                check |= check.substring[0, check.index-of[@s] + @s.length]\n        }\n        result.push![check]\n}\n\nString.instance.substring = {\n    [@self, [@start]]: @self.substring[@start, @self.length]\n    [@self, [@start, @end]]:\n        start = @start\n        end = @end\n        (start < 0).on {\n            true: start |= @self.length + start\n            false: nil\n        }\n        (end < 0).on {\n            true: end |= @self.length + end\n            false: nil\n        }\n        result = ''\n        i = start\n        {[]: i < end}.while-true {\n            []:\n                result |= result + @self[i]\n                i |= i + 1\n        }\n        result\n}\n\nString.instance.replace = {\n    [@self, [@substring, @replace]]: @self.split[@substring].join[@replace]\n}\n\nString.instance.replace-first = {\n    [@self, [@substring, @replace]]:\n        list = @self.split[@substring]\n        if list.length <= 1\n            @self\n        else\n            result = list[0] + @replace\n            i = 1\n            {[]: i < list.length - 1}.while-true {\n                []:\n                    result |= list[i] + @substring\n                    i |= i + 1\n            }\n            result + list[list.length - 1]\n}\n\nString.instance.repeat = {\n    [@self, [0]]: ''\n    [@self, [@n]]: @self.repeat[@n - 1] + @self\n}\n\nString.instance.matches-set? = {\n    [@self, [@set]]:\n        i = 0\n        result = @self.length > 0\n        {[]: i < @self.length and result}.while-true {\n            []:\n                result |= @set.contains?[@self[i]]\n                i |= i + 1\n        }\n        result\n}\n\nString.instance.uppercase? = {\n    [@self]: @self.matches-set[String.uppercase-set]\n}\n\nString.instance.lowercase? = {\n    [@self]: @self.matches-set[String.lowercase-set]\n}\n\nString.instance.alpha? = {\n    [@self]: @self.uppercase? or @self.lowercase?\n}\n\nString.instance.alphanumeric? = {\n    [@self]: @self.matches-set[String.alphanumeric-set]\n}\n\nString.instance.uppercase = {\n    [@self]:\n        result = ''\n        i = 0\n        {[]: i < @self.length}.while-true {\n            []:\n                char = @self[i]\n                if char.lowercase?\n                    char |= String.uppercase-set[String.lowercase-set.index-of[char]]\n                else\n                    nil\n                result |= result + char\n                i |= i + 1\n        }\n        result\n}\n\nString.instance.lowercase = {\n    [@self]:\n        result = ''\n        i = 0\n        {[]: i < @self.length}.while-true {\n            []:\n                char = @self[i]\n                if char.uppercase?\n                    char |= String.lowercase-set[String.uppercase-set.index-of[char]]\n                else\n                    nil\n                result |= result + char\n                i |= i + 1\n        }\n        result\n}\n\nString.instance.swap-case = {\n    [@self]:\n        result = ''\n        i = 0\n        {[]: i < @self.length}.while-true {\n            []:\n                char = @self[i]\n                if char.uppercase?\n                    char |= String.lowercase-set[String.uppercase-set.index-of[char]]\n                else if char.lowercase?\n                    char |= String.uppercase-set[String.lowercase-set.index-of[char]]\n                else\n                    nil\n                result |= result + char\n                i |= i + 1\n        }\n        result\n}\n\nString.instance.title-case = {\n    ['']: ''\n    [@self]:\n        list = @self.split[' ']\n        result = ''\n        i = 0\n        {[]: i < list.length}.while-true {\n            []:\n                if i != 0\n                    result |= result + ' ' + list[i][0].uppercase + list[i].substring[1]\n                else\n                    result |= result + list[i][0].uppercase + list[i].substring[1]\n                i |= i + 1\n        }\n        result\n}\n\nString.instance.capitalize = {\n    ['']: ''\n    [@self]: @self[0].uppercase + @self.substring[1].lowercase\n}\n\nString.instance.cap-first = {\n    ['']: ''\n    [@self]: @self[0].uppercase + @self.substring[1]\n}\n\nString.instance.quote = {\n    [@self]: '\"' + (@self.replace['\\\\', '\\\\\\\\'].replace['\"', '\\\\\"']) + '\"'\n}\n\n#|\n& -> &amp;\n< -> &lt;\n> -> &gt;\n\" -> &quot;\n' -> &apos;\n|#\nString.instance.escape-html = {\n    [@self]: @self.replace['&', '&amp;'].replace['<', '&lt;'].replace['>', '&gt;'].replace['\"', '&quot;'].replace['\\'', '&apos;']\n}\n\nString.instance.unescape-html = {\n    [@self]: @self.replace['&amp;', '&'].replace['&lt;', '<'].replace['&gt;', '>'].replace['&quot;', '\"'].replace['&apos;', '\\'']\n}\n\nString.instance.lines = {\n    [@self]: @self.split['\\n']\n}\n");Yak.interpreter.ALLOW_CLASS_REDEFINITION=false;