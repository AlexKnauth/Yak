!function(){var e,t,n,r,i,a,u,s,l,o,c,f,p,h,v,m,y,g,w,b,d,k,x=[].slice;e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-+*/%^_$<>=?!";c=function(e,t){throw new SyntaxError(""+t+" at "+e.file+":"+e.line+":"+e.character)};s=function(e){return e[e.length-1]};y=function(){var t,n,r,i;i={"(":"group start",")":"group end","{":"funject start","}":"funject end","[":"list start",",":"list delimiter","]":"list end",":":"pattern match","=":"strict assignment",":=":"lazy assignment","|=":"reset strict assignment","|:=":"reset lazy assignment","<-":"inverse assignment","<<":"inheritance assignment","::":"prototypal application"};r=function(e){return e===" "||e==="	"};t=function(e){return-1!=="0123456789".indexOf(e)};n=function(t){return-1!==e.indexOf(t)};return function(e,a,u){var l,o,f,p,h,v,m,y,g,w,b,d,k,j,S,M,q,O,T,C;if(a==null){a="<anonymous>"}if(u==null){u=1}T=function(e,t){if(t==null){t=""}return{type:e,value:t,line:d,file:a,character:h}};O=function(e){throw new SyntaxError(""+e+" at "+a+":"+d+":"+h)};M="";m=0;while(true){g=e.indexOf("#",m);if(g===-1){break}M+=e.substring(m,g);m=g+1;p=e[m];if(p==="|"){++m;q=m;j=1;while(j){l=e.indexOf("#|",m);f=e.indexOf("|#",m);if(l===-1&&f===-1){throw new SyntaxError("Unmatched multiline comment")}if(l!==-1&&(l<f||f===-1)){++j;m=l+2}if(f!==-1&&(f<l||l===-1)){--j;m=f+2}}M+=Array(e.substring(q,m).split("\n").length).join("\n")}else{g=e.indexOf("\n",m);if(g===-1){break}m=g}}M+=e.substring(m);m=0;h=0;w=0;d=u;b=M.length;y=[""];C=[];o=function(){var e,a,u,l,o,c,v,g,k;if(C.length){return C.shift()}p=M[m];while(r(p)){++m;p=M[m]}h=1+m-w;if(m>=b){if(y.length>1){y.pop();return T("outdent")}return T("end")}if((c=M.substr(m,3))==="|:="||(c=M.substr(m,2))===":="||c==="|="||c==="<-"||c==="<<"||c==="::"){m+=c.length;return T(i[c],c)}switch(p){case"\n":case"\r":while(true){while(p==="\n"||p==="\r"){++m;++d;w=m;h=1+m-w;p=M[m]}v="";while(true){p=M[m];if(!r(p)){break}v+=p;++m}if(!(p==="\n"||p==="\r")){break}}u=s(y);l=v.length;o=u.length;switch(false){case l!==o:if(v!==u){O("Inconsistent indentation")}return T("newline");case!(l<o):while(l<o){C.push(T("outdent"));y.pop();u=s(y);o=u.length}if(p&&v!==u){O("Inconsistent indentation")}return C.shift();case!(l>o):if(u!==v.substr(0,o)){O("Inconsistent indentation")}y.push(v);return T("indent")}break;case"{":case"}":case"[":case"]":case":":case"=":case",":case"(":case")":++m;if(p==="="&&M[m]==="="){--m}else{return T(i[p],p)}}if(p==="-"){c=M[m+1];if(c==="."||t(c)){a=true}}if(a||p==="."||t(p)){k="";q=m;if(p==="-"){k+=p;++m;p=M[m]}if(t(p)){while(true){k+=p;++m;p=M[m];if(!t(p)){break}}}f=false;if(p==="."){k+=p;++m;p=M[m];if(!t(p)){--m;p=M[m];if(k!=="."){return T("number",+k.substr(0,k.length-1))}f=true}else{while(true){k+=p;++m;p=M[m];if(!t(p)){break}}}}if(!f){if(p==="e"||p==="E"){k+=p;++m;p=M[m];if(p==="+"||p==="-"){k+=p;++m;p=M[m]}if(!t(p)){h=1+m-w;O("Expected digit")}while(true){k+=p;++m;p=M[m];if(!t(p)){break}}}if(n(p)){m=q;p=M[m]}else{return T("number",+k)}}}if(p==="@"||p==="."||n(p)){g=p==="@"?"formal parameter":p==="."?"symbol":"identifier";k="";while(true){k+=p;++m;p=M[m];if(!n(p)){break}}if(k==="true"||k==="false"){return T("boolean",k==="true")}if(-1!==["nil","unknown","class","module","try","catch","finally","if","then","else"].indexOf(k)){return T(k,k)}if(g==="symbol"){if(k.length===1){h=1+m-w;O("Expected identifier")}return T(g,k.substr(1))}return T(g,k)}if(p==='"'||p==="'"){e=p;k="";++m;p=M[m];while(true){if(p===e){break}if(p==="\\"){++m;switch(p=M[m]){case'"':case"'":case"\\":k+=p;break;case"n":k+="\n";break;case"r":k+="\r";break;case"t":k+="	";break;default:h=1+m-w;O("Invalid escape sequence")}++m;p=M[m];continue}if(!p){O("Unterminated string")}k+=p;++m;p=M[m]}++m;return T("string",k)}return O("Unexpected "+p)};v=o();k=o();S=null;return{here:function(){return v},next:function(){return k},advance:function(){S=v;v=k;k=o();return S},match:function(){var e;e=1<=arguments.length?x.call(arguments,0):[];if(-1!==e.indexOf(v.type)){return this.advance()}if(S&&S.type==="outdent"&&-1!==e.indexOf("newline")){return{type:"newline",value:"",file:S.file,line:S.line,character:S.character}}return null},accept:function(){var e;e=1<=arguments.length?x.call(arguments,0):[];if(-1!==e.indexOf(v.value)){return this.advance()}return null},require:function(){var e;e=1<=arguments.length?x.call(arguments,0):[];return this.match.apply(this,e)||c(v,"Expected "+e.join(" or "))},requireValue:function(){var e;e=1<=arguments.length?x.call(arguments,0):[];return this.accept.apply(this,e)||c(v,"Expected '"+e.join("', '")+"'")}}}}();o=function(){var e,t,n,r,i,a,u,s;u={};e={"^":-7,"*":6,"/":6,"%":6,"+":5,"-":5,">":4,"<":4,">=":4,"<=":4,"==":3,"!=":3,is:3,isnt:3,and:2,or:2};t={not:2};n=function(){function e(){}e.prototype["null"]=function(){return c("Unexpected operator")};e.prototype.left=function(){return c("Unexpected value")};return e}();o=function(e,t,n){var r,i;i=y(e,t,n);while(i.match("newline")){}r=a(i);i.require("end");return r};a=function(e){var t,n,i;t=e.here();n=[];while(true){i=r(e,0,true);if(!i){break}n.push(i);if(!e.match("newline")){break}}return{file:t.file,line:t.line,character:t.character,type:"sequence",expressions:n}};r=function(t,n,i,u){var l,o,f,p,h,v,m,y,g,w,b,d,k,x,j,S,M,q,O;if(n==null){n=0}if(t.match("indent")){x=a(t);t.require("outdent");return x}if(j=t.match("class","module")){if(g=t.match("identifier")){while(true){if(M=t.match("symbol")){g={type:"application",file:M.file,line:M.line,character:M.character,funject:g,argument:M};continue}break}}if(t.accept("<")){k=r(t,0,false,true)}if(t.here().type!=="indent"){c(t.here(),"Expected indent")}o=r(t);x={type:j.type,file:j.file,line:j.line,character:j.character,body:o,parent:k};if(!g){return x}return{type:"assignment",operator:"strict assignment",file:j.file,line:j.line,character:j.character,left:g,right:x}}if(j=t.match("try")){if(t.here().type!=="indent"){c(t.here(),"Expected indent")}o=r(t);t.require("catch");O=t.require("identifier");g=t.match("identifier");if(t.here().type!=="indent"){c(t.here(),"Expected indent")}y=r(t);x={type:"try",file:j.file,line:j.line,character:j.character,body:o,"class":O,"catch":y};if(g){x.name=g}if(t.match("finally")){x["finally"]=r(t)}return x}if(j=t.match("if")){f=r(t,0,false,true);if(t.here().type!=="indent"){t.require("then")}q=r(t);if(t.match("else")){if(t.here().type!=="indent"&&!t.here().type==="if"){c(t.here(),"Expected indent")}m=r(t)}return{type:"if",file:j.file,line:j.line,character:j.character,condition:f,trueBody:q,falseBody:m}}h=s(t);if(!h){if(i){return null}else{c(t.here(),"Expected expression")}}while(true){if(M=t.match("symbol")){h={type:"application",file:M.file,line:M.line,character:M.character,funject:h,argument:M};continue}if(t.here().type==="list start"){M=t.here();h={type:"application",file:M.file,line:M.line,character:M.character,funject:h,argument:s(t)};continue}if(n<7){if(t.here().type==="identifier"){p=false;for(w in e){d=e[w];if(n<Math.abs(d)&&(M=t.accept(w))){h={type:"application",file:M.file,line:M.line,character:M.character,funject:h,argument:M};v=d<0?-1-d:d;if(b=r(t,v,true,u)){h=w==="and"||w==="or"?{type:w,file:M.file,line:M.line,character:M.character,left:h.funject,right:b}:{type:"application",file:M.file,line:M.line,character:M.character,funject:h,argument:b}}p=true;break}}if(p){continue}}if("identifier"===t.here().type&&!e[t.here().value]||-1!==["formal parameter","string","number","boolean","nil","unknown","funject start","group start","list start"].indexOf(t.here().type)){M=t.here();h={type:"application",file:M.file,line:M.line,character:M.character,funject:h,argument:r(t,7,false,u)};continue}if(M=t.match("prototypal application")){S=t.require("identifier");S.type="symbol";h={type:"application",file:M.file,line:S.line,character:S.character,funject:{type:"application",file:M.file,line:M.line,character:M.character,funject:h,argument:{type:"symbol",file:M.file,line:M.line,character:M.character,value:"instance"}},argument:S};continue}if(!u&&"indent"===t.here().type){M=t.here();h={type:"application",file:M.file,line:M.line,character:M.character,funject:h,argument:r(t)};break}}break}if(n===0&&(l=t.match("strict assignment","lazy assignment","reset strict assignment","reset lazy assignment","inverse assignment","inheritance assignment"))){if(l.type!=="inheritance assignment"&&l.type!=="inverse assignment"&&h.type!=="identifier"&&(h.type!=="application"||l.type!=="strict assignment"&&l.type!=="lazy assignment")){c(l,"Invalid left-hand side of assignment")}h={type:"assignment",operator:l.type,file:l.file,line:l.line,character:l.character,left:h,right:r(t,0,false,u)}}return h};s=function(e){var n,a,u,s;if(e.match("group start")){n=r(e);e.require("group end");return n}if(u=e.match("list start")){s=[];if(!e.match("list end")){while(true){s.push(r(e));if(e.match("list end")){break}e.require("list delimiter")}}return{file:u.file,line:u.line,character:u.character,type:"list",values:s}}if(u=e.match("funject start")){a=[];if(!e.match("funject end")){if(e.match("indent")){while(true){a.push(i(e));if(e.match("outdent")){break}e.require("newline")}e.require("funject end")}else{a.push(i(e));e.require("funject end")}}return{file:u.file,line:u.line,character:u.character,type:"funject",patterns:a}}if(e.here().type==="identifier"&&Object.prototype.hasOwnProperty.call(t,e.here().value)){u=e.advance();return{type:"application",file:u.file,line:u.line,character:u.character,funject:r(e,t[u.value]),argument:{type:"symbol",file:u.file,line:u.line,character:u.character,value:"not"}}}if(u=e.match("identifier","formal parameter","symbol","string","number","boolean","nil","unknown")){return u}};i=function(e){var t,n;t=r(e);e.require("pattern match");n=r(e);return{pattern:t,value:n}};return o}();f=function(e){var t;t=function(e){var n,r;switch(e.type){case"number":return["Token-number",e.value];case"symbol":return["Token-symbol",e.value];case"string":return["Token-string",e.value];case"boolean":return["Token-boolean",e.value];case"nil":return["Token-nil"];case"unknown":return["Token-unknown"];case"identifier":return["Token-identifier",e.value];case"formal parameter":return["Token-parameter",e.value];case"list":return["Token-list",function(){var n,i,a,u;a=e.values;u=[];for(n=0,i=a.length;n<i;n++){r=a[n];u.push(t(r))}return u}()];case"funject":return["Token-funject",function(){var r,i,a,u;a=e.patterns;u=[];for(r=0,i=a.length;r<i;r++){n=a[r];u.push([t(n.pattern),t(n.value)])}return u}()];case"sequence":return["Token-sequence",function(){var n,i,a,u;a=e.expressions;u=[];for(n=0,i=a.length;n<i;n++){r=a[n];u.push(t(r))}return u}()];case"application":return["Token-invocation",t(e.funject),t(e.argument)];case"or":case"and":return["Token-"+e.type,t(e.left),t(e.right)];case"class":case"module":if(e.parent){return["Token-"+e.type,t(e.parent),t(e.body)]}else{return["Token-"+e.type,t(e.body)]}break;case"try":if(e["finally"]){return["Token-try",t(e.body),t(e["catch"]),t(e["finally"])]}else{return["Token-try",t(e.body),t(e["catch"])]}break;case"assignment":switch(e.operator){case"strict assignment":if(e.left.type==="application"){return["Token-funject-strict-assignment",t(e.left),t(e.right)]}else{return["Token-strict-assignment",t(e.left),t(e.right)]}break;case"lazy assignment":if(e.left.type==="application"){return["Token-funject-lazy-assignment",t(e.left),t(e.right)]}else{return["Token-lazy-assignment",t(e.left),t(e.right)]}break;case"reset strict assignment":return["Token-reset-strict-assignment",t(e.left),t(e.right)];case"reset lazy assignment":return["Token-reset-lazy-assignment",t(e.left),t(e.right)];case"inheritance assignment":return["Token-funject-inheritance",t(e.left),t(e.right)];case"inverse assignment":return["Token-inverse-definition",t(e.left),t(e.right)]}}};return t(o(e))};p=function(e){var t,n,r,i;r=y(e);t="";i=[];while(true){n=r.advance();if(n.type==="end"){break}switch(n.type){case"indent":console.log(""+t+"{");i.push(t+="    ");break;case"outdent":t=t.substr(4);i.push(console.log(""+t+"}"));break;case"newline":i.push(console.log(""+t+";"));break;default:i.push(console.log(""+t+"(:"+n.line+":"+n.character+") <"+n.type+"> "+n.value))}}return i};h=function(e){var t;t=function(e,n){var r,i,a,u,s,l,o,c,f,p,h,v,m,y;if(n==null){n=""}if(e instanceof Array){if(typeof e[0]==="string"){r=e[0].replace(/^Token-/,"");if(e.length===2&&typeof e[1]!=="object"){return console.log(""+n+r+": "+e[1])}else{console.log(""+n+r);if(e[1]&&typeof e[1][0]!=="string"){f=e[1];v=[];for(a=0,l=f.length;a<l;a++){i=f[a];v.push(t(i,n+"    "))}return v}else{p=e.slice(1);m=[];for(u=0,o=p.length;u<o;u++){i=p[u];m.push(t(i,n+"    "))}return m}}}else{console.log(""+n+"pattern:");h=e.slice(0);y=[];for(s=0,c=h.length;s<c;s++){i=h[s];y.push(t(i,n+"    "))}return y}}else{return console.log(n+e)}};return t(f(e))};m=function(e){};if(typeof module!=="undefined"&&module!==null){d=exports;if(!module.parent){i=null;v=false;a=2;g=false;b=false;n=process.argv.length;while(a<n){switch(t=process.argv[a++]){case"-r":v=true;break;case"-t":g=true;break;case"-v":b=true;break;case"-e":i=process.argv[a++];break;default:i=""+require("fs").readFileSync(t);break}}if(a<n||i==null){console.error("Usage: coffee parser.coffee [ -r | -t | -v ] [ <filename> | -e <expression> ]");return}try{if(g){p(i)}else if(b||v){l=v?f:o;console.log(JSON.stringify(l(i),void 0,2))}else{h(i)}}catch(j){r=j;if(r instanceof SyntaxError){console.error(r.message)}else{throw r}}}}else{(this.Yak!=null?this.Yak:this.Yak={}).parser=d={}}k={IDENTIFIER_CHARS:e,parse:o,stringify:m,tokenizer:y,parseForRacket:f};for(u in k){w=k[u];d[u]=w}}.call(this);!function(){var e,t,n,r,i,a,u,l,o,c,f,p,h,v,m,y,g,w,b,d,k,x,j,S,M,q,O,T,C,E,$,I,z,_,F,N,P,L,B,A,U,H,Y,K,R,D,G,J,V,X,Q,W,Z,et,tt,nt={}.hasOwnProperty,rt=function(e,t){for(var n in t){if(nt.call(t,n))e[n]=t[n]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},it=[].slice;k=typeof global!=="undefined"&&global!==null?global:this;e=false;h={};N=function(e){return e[e.length-1]};T=function(e,t){var n,r;for(n in t){r=t[n];e[n]=r}return e};x=function(e,t){var n,r,i,a;if(e.type!==t.type){return false}switch(e.type){case"list":if(e.value.length!==t.value.length){return false}for(n=i=0,a=e.length;i<a;n=++i){r=e[n];if(!x(r,t[n])){return false}}return true;case"funject":return e===t;case"number":case"boolean":case"string":case"symbol":return e.value===t.value;case"nil":case"unknown":return true}};u=function(){function e(e){this.message=e}return e}();g=function(){function e(e){this.error=e}return e}();p=function(e){rt(t,e);function t(e,t){this.message=e;this.trace=t}return t}(Error);c=function(e){rt(t,e);function t(e,n){t.__super__.constructor.call(this,"No match for "+e+" applied to "+n)}return t}(u);v=function(){function e(e,t,n){var r,i;this.parent=e;if(n==null){n=true}this.vars=Object.create(null);if(t!=null){for(r in t){i=t[r];if(n){this.vars[r]=i}else{this.set(r,i)}}}}e.prototype.get=function(e){if(Object.prototype.hasOwnProperty.call(this.vars,e)){return this.vars[e]}if(this.parent){return this.parent.get(e)}throw new u("Undefined variable "+e)};e.prototype.set=function(e,t){if(this.isProxy){return this.parent.set(e,t)}else{if(t.name==null){t.name=e}return this.vars[e]=t}};e.prototype.reset=function(e,t){if(Object.prototype.hasOwnProperty.call(this.vars,e)){return this.vars[e]=t}if(this.parent){return this.parent.reset(e,t)}throw new u("Cannot reset undefined variable "+e)};return e}();i=function(){e.prototype.type="funject";e.prototype.toString=function(){var e,t;try{t=(new a).evaluate({type:"application",funject:{type:"value",value:this},argument:{type:"symbol",value:"to-string"}});if(t.isString){return t.value}else{return this.basicToString()}}catch(n){e=n;if(e instanceof p){return this.basicToString()}else{throw e}}};e.prototype.basicToString=function(){if(this.isClass){if(this.name){return"#<class "+this.name+">"}else{return"#<class>"}}else if(this.call&&this.call.length!==0){return"#<primitive>"}else{return"#<funject>"}};e.prototype.toSource=function(e){var t,n;if(e===0){return this.basicToString()}try{n=(new a).evaluate({type:"application",funject:{type:"value",value:this},argument:{type:"symbol",value:"inspect"}});if(n.isString){return n.value}else{return this.getSource()}}catch(r){t=r;if(t instanceof p){return this.getSource(e)}else{throw t}}};e.prototype.getSource=function(e){if(e===0||this.isClass||this.call&&this.call.length!==0){return this.basicToString()}else if(!this.patterns||this.patterns.length===0){return"{}"}else{return this.basicToString()}};function e(e){var t,n;this.patterns=[];if(e){for(t in e){n=e[t];this[t]=n}}}e.prototype.methodHasArgs=function(){var e,t,n,r,i,a,s,l,o,c,f;i=this;t=null;e=function(e){if(t!=null&&t!==e){throw new u("Method cannot match both [@self] and [@self, @arg]")}return t=e};while(true){if(i.call){n=0;r=i.call.length;while(n<r){l=i.call[n++];while(l==="own"||l==="interpreter"){l=i.call[n++]}if(l instanceof Array){if(l.length===1){e(false)}if(l.length===2){e(true)}}++n}}if(i.patterns){f=i.patterns;for(o=0,c=f.length;o<c;o++){a=f[o];s=a.pattern;if(s.type==="list"&&s.values.length===1){e(false)}if(s.type==="list"&&s.values.length===2){e(true)}}}if(t!=null){return t}if(!(i=i.parent)){throw new u(""+this+" is not a method")}}};e.prototype.isKindOf=function(e){var t;t=this.instance;while(t){if(t===e.$instance){return true}t=t.parent}return false};e.prototype.isMemberOf=function(e){return this.instance===e.$instance};e.prototype.hasSymbol=function(e){var t,n,r,i,a,u,s,l;t=this;while(t){if(t.call){s=t.call;for(r=0,a=s.length;r<a;r++){n=s[r];if(n==="symbol"||n[0]==="."&&e===n.substr(1)){return true}}}if(t.patterns){l=t.patterns;for(i=0,u=l.length;i<u;i++){n=l[i];if(n.pattern.type==="formal parameter"||n.pattern.type==="symbol"&&n.pattern.value===e||n.pattern.type==="identifier"&&n.scope.get(n.pattern.value).isMemberOf(F.Symbol)){return true}}}t=t.parent}return false};e.prototype.keys=function(){var e,t,n,r,i,a,s,o,c=this;r=function(e,t){var n;switch(e.type){case"list":return new l(function(){var i,a,u,s;u=e.values;s=[];for(i=0,a=u.length;i<a;i++){n=u[i];s.push(r(n,t))}return s}());case"symbol":return J(e.value);case"string":return new m(e.value);case"number":return new f(e.value);case"nil":case"unknown":return F[e.value];case"identifier":return t.get(e.value);default:throw new u(""+c+" has non-constant keys")}};i=[];if(this.patterns){o=this.patterns;for(a=0,s=o.length;a<s;a++){n=o[a];i.push(r(n.pattern,n.scope))}}if(this.call){e=0;t=this.call.length;while(e<t){n=this.call[e++];while(n==="interpreter"||n==="own"){n=this.call[e++]}if(n[0]==="."){i.push(J(n.substr(1)))}else if(n[0]==='"'){i.push(new m(n.substr(1)))}}}return new l(i)};e.prototype.keysOf=function(e){var t,n,r,i,a;n=[];a=this.keys().value;for(r=0,i=a.length;r<i;r++){t=a[r];if(t.isMemberOf(e)){n.push(t)}}return new l(n)};e.prototype.allKeys=function(){var e,t,n,r,i,a,u,s,o,c;i=[];t=this;while(t){c=t.keys().value;for(a=0,s=c.length;a<s;a++){n=c[a];e=true;for(u=0,o=i.length;u<o;u++){r=i[u];if(x(r,n)){e=false}}if(e){i.push(n)}}t=t.parent}return new l(i)};e.prototype.isObject=function(){var e,t,n,r;r=this.keys();for(t=0,n=r.length;t<n;t++){e=r[t];if(!e.isMemberOf(F.Symbol)){return false}}return true};e.prototype["native"]=function(e,t){var n,r,i,a,u,s,l,o,c,f,p;if(e instanceof Array){if(e[0]==="|"){f=e.slice(1);for(s=0,o=f.length;s<o;s++){a=f[s];if(r=this["native"](a,t)){return r}}return false}r=[];if(!t.isList||e.length!==t.value.length){return false}p=t.value;for(i=l=0,c=p.length;l<c;i=++l){u=p[i];if(n=this["native"](e[i],u)){r=r.concat(n)}else{return false}}return r}if(e==="*"){return[t]}if(F[e]){if(t===F[e]){return[]}else{return false}}if(typeof e==="string"){if(e[0]==="."){if(t.isSymbol&&t.value===e.substr(1)){return[]}}else if(e[0]==='"'){if(t.isString&&t.value===e.substr(1)){return[]}}else if(e[0]==="&"){if(t===E.get(e.substr(1))){return[]}}else{if(t.type===e){return[t]}}return false}};e.prototype.scan=function(e,t,n,r,i){var a,s,l,o,c,f;if(r.type==="list"){if(!(i.isList&&i.value.length===r.values.length)){return false}f=r.values;for(a=o=0,c=f.length;o<c;a=++o){l=f[a];if(!(s=this.scan(e,t,n,l,i.value[a]))){return false}}return true}if(r.type==="formal parameter"){if(Object.prototype.hasOwnProperty.call(t,r.value)){return x(t[r.value],i)}t[r.value]=i;return true}if(r.type==="identifier"){return x(i,e.get(r.value))}if(r.type==="application"){n.push({funject:r.funject,argument:r.argument,value:i});return true}if(r.type==="number"||r.type==="symbol"||r.type==="string"||r.type==="boolean"){return r.type===i.type&&r.value===i.value&&true}if(r.type==="nil"||r.type==="unknown"){return r.type===i.type&&true}throw new u("Invalid pattern")};e.prototype.match=function(e,t,n,r){var i,a,s,l,o,c,f,p;if(n.type==="list"){a={};p=n.values;for(s=c=0,f=p.length;c<f;s=++c){o=p[s];if(!(l=this.match(e,t,o,r.value[s]))){return false}T(a,l)}return a}if(n.type==="application"){i=e.first().value[e.frame.arg++];if(!i.isList){throw new u("Invalid inverse")}if(!i.value.length){return false}return this.bind(i.value[0],n,{},t)}return{}};e.prototype.bind=function(e,t,n,r){var i,a,u,s;if(t.type==="list"){s=t.values;for(a=0,u=s.length;a<u;a++){i=s[a];this.bind(e,i,n,r)}}else if(t.type==="formal parameter"){if(!Object.prototype.hasOwnProperty.call(r,t.value)){n[t.value]=e}}else if(t.type==="application"){this.bind(e,t.argument,n,r)}return n};e.prototype.substitute=function(e,t){var n;if(t.type==="list"){return new l(function(){var r,i,a,u;a=t.values;u=[];for(r=0,i=a.length;r<i;r++){n=a[r];u.push(this.substitute(e,n))}return u}.call(this))}if(t.type==="number"){return new f(t.value)}if(t.type==="string"){return new m(t.value)}if(t.type==="symbol"){return J(t.value)}if(t.type==="formal parameter"){if(Object.prototype.hasOwnProperty.call(e,t.value)){return e[t.value]}return F.unknown}if(t.type==="application"){throw new u("Nested applications are unimplemented")}if(t.type==="boolean"||t.type==="nil"||t.type==="unknown"){return F[t.value]}};e.prototype.apply=function(t,n,r,i,a){var s,o,f,p,m,y,g,w,b,d,k,x,j,S,M,q,O,C,E,$,I,z,_;if(a==null){a=true}if(this.call){w=0;b=this.call.length;while(w<b){j=this.call[w++];if(S=j==="interpreter"){j=this.call[w++]}if(M=j==="own"){j=this.call[w++]}C=this.call[w++];if(p=this["native"](j,r)){if(M){p.unshift(n)}if(S){p.unshift(t)}if(h===(q=C.apply(this,p))){return}return t["return"](q)}}}if(this.patterns){f=(I=t.frame.arg)!=null?I:0;k=(z=t.frame.index)!=null?z:0;_=this.patterns.slice(k);for(w=E=0,$=_.length;E<$;w=++E){x=_[w];o=[];if(t.frame.bindings){m=t.frame.bindings;o=t.frame.applications;delete t.frame.applications;delete t.frame.bindings}else{m={};if(!this.scan(x.scope,m,o,x.pattern,r)){continue}}if(o.length){if(t.frame.step==="match"){if(!(y=this.match(t,m,x.pattern,r))){delete t.frame.step;continue}T(m,y)}else if(t.frame.step==="inverse"){d=t.frame.expression;t.pop();t.stack.push({expression:{line:d.line,character:d.character,type:"reapply funject","private":i,funject:this,argument:r,own:n,instance:a},arguments:[],step:"match",applications:o,bindings:m,arg:f,index:k+w});t.push({line:x.pattern.line,character:x.pattern.character,type:"list",values:function(){var e,n,r,i;r=t.first().value;i=[];for(w=e=0,n=r.length;e<n;w=++e){s=r[w];if(!s.inverse){throw new u(""+s+" has no inverse")}i.push({type:"application",funject:{type:"value",value:s.inverse},argument:{type:"value",value:new l([o[w].value,this.substitute(m,o[w].argument)])}})}return i}.call(this)});return}else{d=t.frame.expression;t.pop();t.stack.push({expression:{line:d.line,character:d.character,type:"reapply funject","private":i,funject:this,argument:r,own:n,instance:a},arguments:[],step:"inverse",applications:o,bindings:m,arg:f,index:k+w});t.push({line:x.pattern.line,character:x.pattern.character,type:"list",values:function(){var e,t,n;n=[];for(e=0,t=o.length;e<t;e++){s=o[e];n.push(s.funject)}return n}()});return}}if(x.value){return t["return"](x.value)}else{t.pop();O=t.scope;m.own=n;if(i){m["private"]=i}t.scope=new v(x.scope,m,true);t.push({type:"set scope",scope:O});t.push(x.expression)}return}}if(a&&r.isSymbol&&this.instance&&this.instance.hasSymbol(r.value)){g=t.frame.expression;t.pop();t.pop();t.push({type:"native",value:function(){var t,i,a;i=this.first();if(i.name==null){i.name="instance."+r.value}if(i.expression){((a=this.frame).expression!=null?(a=this.frame).expression:a.expression={}).file=i.expression.file;this.frame.expression.line=i.expression.line;this.frame.expression.character=i.expression.character}t=i.methodHasArgs();this.callStack.pop();if(t){return this["return"](new e({call:["interpreter","*",function(t,r){t.pop();t.push({type:"application",file:g!=null?g.file:void 0,line:g!=null?g.line:void 0,character:g!=null?g.character:void 0,"private":n["private"]!=null?n["private"]:n["private"]=new e,funject:{type:"value",value:i},argument:{type:"value",value:new l([n,r])}});return h}]}))}else{this.pop();return this.push({type:"application",file:g!=null?g.file:void 0,line:g!=null?g.line:void 0,character:g!=null?g.character:void 0,"private":n["private"]!=null?n["private"]:n["private"]=new e,funject:{type:"value",value:i},argument:{type:"value",value:new l([n])}})}}});t.push({type:"application",file:g!=null?g.file:void 0,line:g!=null?g.line:void 0,character:g!=null?g.character:void 0,funject:{type:"value",value:this.instance},argument:{type:"value",value:r},instance:false});return}if(this.parent&&this.parent!==this){return this.parent.apply(t,n,r,i,a)}t.callStack.pop();throw new c(n,r)};e.bridge=function(t,n){var r;if(n==null){n=k}if(t==null){return F.nil}if(t instanceof Array){return new l(function(){var n,i,a;a=[];for(n=0,i=t.length;n<i;n++){r=t[n];a.push(e.bridge(r))}return a}())}switch(typeof t){case"number":return new f(t);case"string":return new m(t);case"boolean":return F[t];case"function":return new e({call:["list",function(r){return e.bridge(t.apply(n,e.unbridge(r)))},"symbol",function(n){return e.bridge(t[n.value],t)}]});case"object":return new e({call:["symbol",function(n){return e.bridge(t[n.value],t)}]})}};e.unbridge=function(t){var n,r,i,s,l,o,c,f,p,h,v;switch(t.type){case"nil":return null;case"unknown":throw new u("Cannot unbridge "+t.type);break;case"number":case"string":case"boolean":return t.value;case"symbol":throw new u("Cannot unbridge symbols");break;case"list":p=t.value;v=[];for(l=0,c=p.length;l<c;l++){s=p[l];v.push(e.unbridge(s))}return v;break;case"funject":if(t.isObject()){n=new a;i={};h=t.keysOf(F.Symbol).value;for(o=0,f=h.length;o<f;o++){r=h[o];i[r.value]=e.unbridge(n.evaluate({type:"application",funject:{type:"value",value:t},argument:{type:"symbol",value:r.value}}))}return i}else{return function(){return e.unbridge((new a).evaluate({type:"application",funject:{type:"value",value:t},argument:{type:"value",value:e.bridge([].slice.call(arguments))}}))}}}};return e}();G=function(e,t,n){var r,a,u,s;if(n==null){n=i}r=[];if(t){s=function(e){return r.push("."+a,function(){return e})};for(a in t){u=t[a];s(u)}}return new n({call:r,parent:e})};D=function(e,t){return new i({call:[e,t]})};R=function(e,t,n){var a,u,s,o,c,f,p,h;p=n!=null?n:{},u=p.exports,s=p.instance,f=p._instance;o=f!=null?f:G(t!=null?t.$instance:void 0,s);o.isInstance=true;c=G(t,u!=null?u:{},r);if(t==null){delete c.parent}c.$instance=o;c.$super=t;c.$subclasses=new l([]);if(t){t.$subclasses.value.push(c)}c.instance=((h=F.Class)!=null?h:c).$instance;c.name=e;a="to-"+e.toLowerCase();(c.call!=null?c.call:c.call=[]).unshift("interpreter",["*"],function(e,t){return{lazy:{type:"application",funject:{type:"value",value:t},argument:{type:"symbol",value:a}}}});c.inverse=new i({call:[["*",["unknown"]],function(e){var t;t=e.instance;while(t){if(t===o){return new l([e])}t=t.parent}return new l([])}]});F[e]=c;return c};K=function(e){return F[!!e]};J=function(e){if(Object.prototype.hasOwnProperty.call(y.instances,e)){return y.instances[e]}else{return y.instances[e]=new y(e)}};F={};t=G(null,{initialize:D(["*"],function(e){return F.nil}),"append!":D(["*",["*","*"]],function(e,t,n){(e.patterns!=null?e.patterns:e.patterns=[]).push({pattern:{type:"identifier",value:"k"},scope:new v(null,{k:t}),value:n});return F.nil}),"insert!":D(["*",["number","*","*"]],function(e,t,n,r){t=t.value;if(t<0){t=e.patterns?e.patterns.length+t:t}if(t%1!==0||t<0||(e.patterns?t>e.patterns.length:t>0)){throw new u("Cannot insert at "+t)}(e.patterns!=null?e.patterns:e.patterns=[]).splice(t,0,{pattern:{type:"identifier",value:"k"},scope:new v(null,{k:n}),value:r});return F.nil}),clone:D(["*"],function(e){return new i({parent:e})}),name:D(["*"],function(e){if(e.name){return new m(e.name)}else{return F.nil}}),apply:new i({call:["interpreter",["*",["*"]],function(e,t,n){e.pop();e.push({type:"application",funject:{type:"value",value:t},argument:{type:"value",value:n}});return h}]}),on:new i({call:["interpreter",["*","*"],function(e,t,n){e.pop();e.push({type:"application",funject:{type:"value",value:n},argument:{type:"value",value:t}});return h}]}),then:new i({call:["interpreter",["*",["*"]],function(e,t,n){e.pop();e.push({type:"application",funject:{type:"value",value:n},argument:{type:"value",value:t}});return h}]}),is:D(["*","*"],function(e,t){return K(e===t)}),isnt:D(["*","*"],function(e,t){return K(e!==t)}),"==":D(["*","*"],function(e,t){return K(x(e,t))}),"!=":D(["*","*"],function(e,t){return K(!x(e,t))}),"symbol?":D(["*"],function(e){return K(e.isSymbol)}),"string?":D(["*"],function(e){return K(e.isString)}),"number?":D(["*"],function(e){return K(e.isNumber)}),"list?":D(["*"],function(e){return K(e.isList)}),"boolean?":D(["*"],function(e){return K(e.isBoolean)}),"nil?":D(["*"],function(e){return K(e.isNil)}),"unknown?":D(["*"],function(e){return K(e.isUnknown)}),"class?":D(["*"],function(e){return K(e.isClass)}),"integer?":D(["*"],function(e){return K(e.isNumber&&e.isInteger())}),"float?":D(["*"],function(e){return K(e.isNumber&&e.isFloat())}),"is-member-of?":D(["*",["class"]],function(e,t){return K(e.isMemberOf(t))}),"is-kind-of?":D(["*",["class"]],function(e,t){return K(e.isKindOf(t))}),"to-string":D(["*"],function(e){if(e.type==="funject"||e.type==="class"){return new m(i.prototype.basicToString.call(e))}else{return new m(""+e)}}),"to-symbol":D(["*"],function(e){return J(e+"")}),"to-boolean":D(["*"],function(e){return K(e!==F.nil&&e!==F.unknown&&e!==F["false"])}),"to-number":D(["*"],function(e){var t;t=e+"";if(+t!==+t){throw new u("Cannot convert "+e+" to a number")}return new f(+t)}),"to-error":new i({call:["interpreter",["*"],function(e,t){return e.createError(""+t)}]}),inspect:D(["*"],function(e){if(e.type==="funject"||e.type==="class"){return new m(e.getSource(-1))}else{return new m(e.toSource())}}),"has?":D(["*",["*"]],function(e,t){var n,r,i,a;a=e.keys().value;for(r=0,i=a.length;r<i;r++){n=a[r];if(x(n,t)){return F["true"]}}return F["false"]}),keys:D(["*"],function(e){return e.keys()}),"keys-of":D(["*",["class"]],function(e,t){return e.keysOf(t)}),"all-keys":D(["*"],function(e){return e.allKeys()}),each:new i({call:["interpreter",["funject",["funject"]],function(e,t,n){var r,i,a,u;u=function(){return e.push({type:"application",funject:{type:"value",value:n},argument:{type:"list",values:[{type:"value",value:a[i]},{type:"application",funject:{type:"value",value:t},argument:{type:"value",value:a[i]}}]}})};i=0;a=t.keys().value;r=a.length;if(r===0){return F.nil}e.pop();e.push({type:"native",value:function(){++i;if(i===r){return this["return"](new l(this.frame["arguments"]))}return u()}});u();return h}]})});i.prototype.instance=t;t.instance=null;r=function(e){rt(t,e);function t(){et=t.__super__.constructor.apply(this,arguments);return et}t.prototype.type="class";t.prototype.isClass=true;t.prototype.create=function(){return new i({instance:this.$instance})};return t}(i);l=function(e){rt(t,e);t.prototype.type="list";t.prototype.isList=true;t.prototype.copy=function(){return new t(this.value)};function t(e){this.value=e}t.prototype.toString=function(){return"["+this.value.join(", ")+"]"};t.prototype.toSource=function(e){var t;return"["+function(){var n,r,i,a;
i=this.value;a=[];for(n=0,r=i.length;n<r;n++){t=i[n];a.push(t.toSource(e-1))}return a}.call(this).join(", ")+"]"};t.prototype.call=["own",["number"],function(e,t){var n;n=t.value<0?e.value.length+t.value:t.value;if(n<0||n>=e.value.length){throw new u("Cannot access "+e+" at "+t)}return e.value[n]},".class",function(){return F.List}];return t}(i);R("Class",null,{instance:{superclass:D(["class"],function(e){var t;return(t=e.$super)!=null?t:F.nil}),subclasses:D(["class"],function(e){return e.$subclasses.copy()}),instance:D(["class"],function(e){return e.$instance}),methods:D(["class"],function(e){return e.$instance.keysOf(F.Symbol)}),"all-methods":D(["class"],function(e){return e.$instance.allKeys(true)})}});r.prototype.parent=G(null,{"class":F.Class});r.prototype.instance=F.Class.$instance;F.Class.$instance.parent=t;R("Funject",null,{_instance:t});F.Class.$super=F.Funject;F.Funject.$subclasses.value.push(F.Class);i.prototype.parent=G(null,{"class":F.Funject});R("Symbol",F.Funject,{instance:{}});R("String",F.Funject,{instance:{initialize:D(["string",["string"]],function(e,t){if(e.value!=null){throw new u(""+e+" is immutable")}return e.value=t.value}),length:D(["string"],function(e){return new f(e.value.length)}),"+":new i({call:[["string","string"],function(e,t){return new m(e.value+t.value)}],inverse:new i({call:[["string",["unknown","string"]],function(e,t){if(t.value!==e.value.slice(-t.value.length)){return new l([])}else{return new l([new m(e.value.slice(0,-t.value.length))])}},["string",["string","unknown"]],function(e,t){if(t.value!==e.value.slice(0,t.value.length)){return new l([])}else{return new l([new m(e.value.slice(t.value.length))])}}]})}),"*":D(["string","number"],function(e,t){return e.repeat(t)}),"contains?":D(["string",["string"]],function(e,t){return K(-1!==e.value.indexOf(t.value))}),replace:D(["string",["string","string"]],function(e,t,n){return new m(e.value.split(t.value).join(n.value))}),"replace-first":D(["string",["string","string"]],function(e,t,n){return new m(e.value.replace(t.value,n.value))})}});I=new i({call:[["number",["unknown"]],function(e){if(e.isInteger()){return new l([e])}else{return new l([])}}]});R("Number",F.Funject,{exports:{random:new i({call:[[],function(){return new f(Math.random())},["number"],function(e){if(!e.isInteger()){throw new u("Cannot generate random["+e+"]")}return new f(Math.floor(Math.random()*e.value))},["number","number"],function(e,t){if(!e.isInteger()||!t.isInteger()||t.value<=e.value){throw new u("Cannot generate random["+e+", "+t+"]")}return new f(e.value+Math.floor(Math.random()*(t.value-e.value)))}]})},instance:{"degrees-to-radians":D(["number"],function(e){return new f(e.value*Math.PI/180)}),"radians-to-degrees":D(["number"],function(e){return new f(e.value*180/Math.PI)}),max:D(["number",["number"]],function(e,t){return new f(e.value>t.value?e.value:t.value)}),min:D(["number",["number"]],function(e,t){return new f(e.value<t.value?e.value:t.value)}),sqrt:D(["number"],function(e){if(e.value<0){throw new u("Cannot compute "+e+".sqrt")}return new f(Math.sqrt(e.value))}),root:D(["number",["number"]],function(e,t){return new f(Math.pow(e.value,1/t.value))}),ln:D(["number"],function(e){return new f(Math.log(e.value))}),log:D(["number",["number"]],function(e,t){return new f(Math.log(e.value)/Math.log(t.value))}),sin:D(["number"],function(e){return new f(Math.sin(e.value))}),cos:D(["number"],function(e){return new f(Math.cos(e.value))}),tan:D(["number"],function(e){return new f(Math.tan(e.value))}),sec:D(["number"],function(e){return new f(1/Math.cos(e.value))}),csc:D(["number"],function(e){return new f(1/Math.sin(e.value))}),cot:D(["number"],function(e){return new f(1/Math.tan(e.value))}),asin:D(["number"],function(e){return new f(Math.asin(e.value))}),acos:D(["number"],function(e){return new f(Math.acos(e.value))}),atan:D(["number"],function(e){return new f(Math.atan(e.value))}),"atan/":D(["number",["number"]],function(e,t){return new f(Math.atan2(e.value,t.value))}),asec:D(["number"],function(e){return new f(Math.acos(1/e))}),acsc:D(["number"],function(e){return new f(Math.asin(1/e))}),acot:D(["number"],function(e){return new f(Math.atan(1/e))}),sinh:D(["number"],function(e){return new f((Math.exp(e.value)-Math.exp(-e.value))/2)}),cosh:D(["number"],function(e){return new f((Math.exp(e.value)+Math.exp(-e.value))/2)}),tanh:D(["number"],function(e){return new f((Math.exp(e.value*2)-1)/(Math.exp(e.value*2)+1))}),coth:D(["number"],function(e){return new f((Math.exp(e.value*2)+1)/(Math.exp(e.value*2)-1))}),sech:D(["number"],function(e){return new f(2/(Math.exp(e.value)+Math.exp(-e.value)))}),csch:D(["number"],function(e){return new f(2/(Math.exp(e.value)-Math.exp(-e.value)))}),asinh:D(["number"],function(e){return new f(Math.log(e.value+Math.sqrt(e.value*e.value+1)))}),acosh:D(["number"],function(e){return new f(Math.log(e.value+Math.sqrt(e.value*e.value-1)))}),atanh:D(["number"],function(e){return new f(Math.log((1+e.value)/(1-e.value))/2)}),acoth:D(["number"],function(e){return new f(Math.log((1-e.value)/(1+e.value))/2)}),asech:D(["number"],function(e){return new f(Math.log(1/e.value+Math.sqrt(1-e.value*e.value)/e.value))}),acsch:D(["number"],function(e){return new f(Math.log(1/e.value+Math.sqrt(1+e.value*e.value)/Math.abs(e.value)))}),abs:new i({call:[["number"],function(e){return new f(e.value<0?-e.value:e.value)}],inverse:new i({call:[["number",["unknown"]],function(e){return new l([new f(e.value),new f(-e.value)])}]})}),ceil:new i({call:[["number"],function(e){return new f(Math.ceil(e.value))}],inverse:I}),floor:new i({call:[["number"],function(e){return new f(Math.floor(e.value))}],inverse:I}),round:new i({call:[["number"],function(e){return new f(Math.round(e.value))}],inverse:I}),"to-fixed":new i({call:[["number",["number"]],function(e,t){if(t.value<0||t.value>20){throw new u("Cannot convert "+e+".to-fixed["+t+"]")}return new m(e.value.toFixed(t.value))}],inverse:I}),"to-pennies":new i({call:[["number"],function(e){return new f(Math.round(e.value*100))}],inverse:new i({call:[["number",["unknown"]],function(e){if(e.isInteger()){return new l([new f(Math.round(e.value)/100)])}else{return new l([])}}]})}),"to-dollars":new i({call:[["number"],function(e){return new f(Math.round(e.value)/100)}],inverse:new i({call:[["number",["unknown"]],function(e){if(e.isInteger()){return new l([new f(Math.round(e.value)/100)])}else{return new l([])}}]})}),times:new i({call:["interpreter",["number",["*"]],function(e,t,n){var r,i;if(!t.isInteger()||t.value<0){throw new u("Cannot "+t+".times[...]")}i=0;r=t.value;if(r===0){return new l([])}e.pop();e.push({type:"native",value:function(){++i;if(i===r){return this["return"](new l(this.frame["arguments"]))}return this.push({type:"application",funject:{type:"value",value:n},argument:{type:"value",value:new l([new f(i)])}})}});e.push({type:"application",funject:{type:"value",value:n},argument:{type:"value",value:new l([new f(i)])}});return h}]}),upto:D(["number",["number"]],function(e,t){var n;if(t.value<e.value){return new l([])}else{return new l(function(){var r,i,a,u;u=[];for(n=r=i=e.value,a=t.value;i<=a?r<=a:r>=a;n=i<=a?++r:--r){u.push(new f(n))}return u}())}}),downto:D(["number",["number"]],function(e,t){var n;if(t.value>e.value){return new l([])}else{return new l(function(){var r,i,a,u;u=[];for(n=r=i=e.value,a=t.value;i<=a?r<=a:r>=a;n=i<=a?++r:--r){u.push(new f(n))}return u}())}}),"+":new i({call:[["number","number"],function(e,t){return new f(e.value+t.value)}],inverse:new i({call:[["number",["|",["number","unknown"],["unknown","number"]]],function(e,t){return new l([new f(e.value-t.value)])}]})}),"-":new i({call:[["number","number"],function(e,t){return new f(e.value-t.value)}],inverse:new i({call:[["number",["number","unknown"]],function(e,t){return new l([new f(t.value-e.value)])},["number",["unknown","number"]],function(e,t){return new l([new f(e.value+t.value)])}]})}),"*":new i({call:[["number","number"],function(e,t){return new f(e.value*t.value)},["number","string"],function(e,t){return t.repeat(e)}],inverse:new i({call:[["number",["|",["number","unknown"],["unknown","number"]]],function(e,t){return new l([new f(e.value/t.value)])}]})}),"/":new i({call:[["number","number"],function(e,t){return new f(e.value/t.value)}],inverse:new i({call:[["number",["number","unknown"]],function(e,t){return new l([new f(t.value/e.value)])},["number",["unknown","number"]],function(e,t){return new l([new f(e.value*t.value)])}]})}),"%":D(["number","number"],function(e,t){var n;n=e.value%t.value;if(n<0){n+=t.value}return new f(n)}),"^":new i({call:[["number","number"],function(e,t){return new f(Math.pow(e.value,t.value))}],inverse:new i({call:[["number",["number","unknown"]],function(e,t){return new l([new f(Math.log(e.value)/Math.log(t.value))])},["number",["unknown","number"]],function(e,t){return new l([new f(Math.pow(e.value,1/t.value))])}]})}),">":D(["number","number"],function(e,t){return K(e.value>t.value)}),"<":D(["number","number"],function(e,t){return K(e.value<t.value)}),">=":D(["number","number"],function(e,t){return K(e.value>=t.value)}),"<=":D(["number","number"],function(e,t){return K(e.value<=t.value)})}});F.Number.call.unshift(".e",function(){return new f(Math.E)},".pi",function(){return new f(Math.PI)});R("List",F.Funject,{instance:{"to-list":D(["list"],function(e){return e}),"empty?":D(["list"],function(e){return K(e.value.length===0)}),length:D(["list"],function(e){return new f(e.value.length)}),length:D(["list"],function(e){return new f(e.value.length)}),"delete-at!":D(["list",["number"]],function(e,t){if(t<0){t+=e.value.length}if(t<0&&t>=e.value.length){throw new u("Cannot delete at "+t+" of "+e)}e.value.splice(t,1);return e}),"insert!":D(["list",["number","*"]],function(e,t,n){t=t.value;if(t<0){t+=e.value.length}if(t<0&&t>e.value.length){throw new u("Cannot insert at "+t+" of "+e)}e.value.splice(t,0,n);return e}),"sort!":new i({call:[["list",[]],function(e){e.value.sort(function(e,t){return(""+e).localeCompare(""+t)});return e},"interpreter",["list",["funject"]],function(e,t,n){var r,i,a;i=0;a=t.value.slice(0);r=a.length;if(r===0){return new l([])}e.pop();e.push({type:"native",value:function(){var e;++i;if(i===r){e=this.frame["arguments"];a.sort(function(t,n){return e[a.indexOf(t)]-e[a.indexOf(n)]});t.value=a;return this["return"](t)}return this.push({type:"application",funject:{type:"value",value:n},argument:{type:"value",value:new l([a[i]])}})}});e.push({type:"application",funject:{type:"value",value:n},argument:{type:"value",value:new l([a[i]])}});return h}]}),"map!":new i({call:["interpreter",["list",["funject"]],function(e,t,n){var r,i,a;i=0;a=t.value.slice(0);r=a.length;if(r===0){return t}e.pop();e.push({type:"native",value:function(){while(true){if(!this.arg(i,{type:"application",funject:{type:"value",value:n},argument:{type:"value",value:new l([a[i]])}})){return}++i;if(i===r){t.value=this.frame["arguments"];return this["return"](t)}}}});return h}]}),"filter!":new i({call:["interpreter",["list",["funject"]],function(e,t,n){var r,i,a,s;i=0;a=t.value.slice(0);r=a.length;if(r===0){return t}s=[];e.pop();e.push({type:"native",value:function(){var e;while(true){if(!this.arg(i,{type:"application",funject:{type:"value",value:n},argument:{type:"value",value:new l([a[i]])}})){return}e=this.frame["arguments"][this.frame["arguments"].length-1];if(!e.isBoolean){throw new u("Cannot filter on "+e)}if(e.value){s.push(a[i])}++i;if(i===r){return this["return"](new l(s))}}}});return h}]}),each:new i({call:["interpreter",["list",["funject"]],function(e,t,n){var r,i,a;i=0;a=t.value.slice(0);r=a.length;if(r===0){return F.nil}e.pop();e.push({type:"native",value:function(){while(true){if(!this.arg(i,{type:"application",funject:{type:"value",value:n},argument:{type:"value",value:new l([a[i]])}})){return}++i;if(i===r){return this["return"](F.nil)}}}});return h}]})}});l.prototype.instance=F.List.$instance;R("Boolean",F.Funject,{instance:{not:new i({call:[["boolean"],function(e){return K(!e.value)}],inverse:new i({call:[["boolean",["unknown"]],function(e){return new l([K(!e.value)])}]})}),and:D(["boolean","boolean"],function(e,t){return K(e.value&&t.value)}),or:D(["boolean","boolean"],function(e,t){return K(e.value||t.value)}),xor:D(["boolean","boolean"],function(e,t){return K(e.value!==t.value)})}});R("Nil",F.Funject);R("Unknown",F.Funject);R("Error",F.Funject,{exports:{"new":new i({call:["interpreter",["*"],function(e,t){return e.createError(""+t)}]})},instance:{initialize:new i({call:["interpreter",["*",["string"]],function(e,t,n){if(t.value!=null){throw new u(""+t+" is immutable")}t.value=n.value;return t.stack=e.stackTrace()}]}),inspect:D(["*"],function(e){return new m("#<Error: "+e.value+"\n"+e.stack+">")}),"to-string":D(["*"],function(e){return new m(e.value+"\n"+e.stack)}),"to-error":D(["*"],function(e){return e}),message:D(["*"],function(e){return new m(e.value)})}});y=function(e){rt(t,e);t.instances={};t.prototype.instance=F.Symbol.$instance;t.prototype.type="symbol";t.prototype.isSymbol=true;function t(e){this.value=e}t.prototype.toString=function(){return this.value};t.prototype.toSource=function(){return"."+this.value};t.prototype.call=[".class",function(){return F.Symbol}];return t}(i);m=function(e){rt(t,e);t.prototype.instance=F.String.$instance;t.prototype.type="string";t.prototype.isString=true;function t(e){this.value=e}t.prototype.call=["own",["number"],function(e,n){var r;r=n.value<0?e.value.length+n.value:n.value;if(r<0||r>=e.value.length){return F.nil}else{return new t(e.value.charAt(r))}},".class",function(){return F.String}];t.prototype.repeat=function(e){if(!e.isInteger()||e.value<0){throw new u("Cannot create "+s.toSource()+" * "+e)}return new t(Array(e.value+1).join(this.value))};t.prototype.toString=function(){return this.value};t.prototype.toSource=function(){return"'"+this.value.replace(/[\\]/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")+"'"};return t}(i);f=function(e){rt(t,e);t.prototype.instance=F.Number.$instance;t.prototype.type="number";t.prototype.isNumber=true;t.prototype.isInteger=function(){return this.value%1===0};t.prototype.isFloat=function(){return this.value%1!==0};function t(e){this.value=e}t.prototype.toString=function(){return""+this.value};t.prototype.toSource=function(){return""+this.value};t.prototype.valueOf=function(){return this.value};t.prototype.call=[".class",function(){return F.Number}];return t}(i);n=function(e){rt(t,e);t.prototype.instance=F.Boolean.$instance;t.prototype.type="boolean";t.prototype.isBoolean=true;function t(e){this.value=!!e}t.prototype.toString=function(){return""+this.value};t.prototype.toSource=function(){return""+this.value};t.prototype.call=[".class",function(){return F.Boolean}];return t}(i);F.nil=new i({instance:F.Nil.$instance,type:"nil",isNil:true,toString:function(){return"nil"},toSource:function(){return"nil"}});F.unknown=new i({instance:F.Unknown.$instance,type:"unknown",isUnknown:true,toString:function(){return"unknown"},toSource:function(){return"unknown"}});F["true"]=new n(true);F["false"]=new n(false);E=new(function(e){rt(t,e);t.prototype.name="<global scope>";function t(){t.__super__.constructor.call(this,null,F)}t.prototype.get=function(e){var n;try{return t.__super__.get.call(this,e)}catch(r){n=r;if(Object.prototype.hasOwnProperty.call(k,e)){return i.bridge(k[e])}else if(e==="require"&&typeof module!=="undefined"&&module!==null){return i.bridge(require)}else{throw n}}};return t}(v));tt=["^","*","/","%","+","-","==","!=","<",">","<=",">=","is","isnt"];for(X=0,W=tt.length;X<W;X++){L=tt[X];E.set(L,J(L))}E.set("by",D(["symbol"],function(e){return D(["*"],function(t){return{lazy:{type:"application",funject:{type:"value",value:t},argument:{type:"value",value:e}}}})}));E.set("import",new i({call:["interpreter",["string"],function(e,t){var n,r;try{t=require("fs").readFileSync(t.value).toString()}catch(a){throw new u("Cannot import "+t)}r=B.parse(t);e.pop();n=e.scope;e.push({type:"native",value:function(){var e;e=this.scope.vars.exports;this.scope=n;return this["return"](e)}});e.scope=new v(null,{exports:new i});e.push(r);return h}]}));E.set("error",new i({call:["interpreter",["*"],function(e,t){e.pop();e.pop();e.callStack.pop();throw new u(""+t);return h}]}));E.set("throw",new i({call:["interpreter",["*"],function(e,t){var n,r;r=e.frame.expression;e.pop();n={type:"application",file:r!=null?r.file:void 0,line:r!=null?r.line:void 0,character:r!=null?r.character:void 0,funject:{type:"value",value:t},argument:{type:"symbol",value:"to-error"}};e.push({type:"native",value:function(){if(!this.args(n)){return}e.pop();e.pop();e.callStack.pop();throw new g(this.first())}});return h}]}));E.set("print",new i({call:[["*"],function(e){console.log(""+e);return F.nil}]}));E.set("debug",new i({call:[["*"],function(e){console.log(e.toSource(-1));return F.nil}]}));_=function(e){return this["return"](F[e.type])};Y=function(e){return this["return"](this.scope.get(e.value))};P=function(e){var t,n;if(!this.args(e.left)){return}t=this.first();if(!t.isBoolean){throw new u("Non-boolean applied to #"+e.type)}if(e.type==="and"?!t.value:t.value){return this["return"](K(e.type==="or"))}if(!this.args(e.left,e.right)){return}n=this.second();if(!n.isBoolean){throw new u("#"+e.type+" applied to non-boolean")}return this["return"](K(n.value))};U=function(e){return function(t){e.call(this,t);if(this.frame["arguments"].length){return this["return"](this.first())}else{return this.pop()}}};a=function(){function t(){}t.prototype.expressions={number:function(e){return this["return"](new f(e.value))},symbol:function(e){return this["return"](J(e.value))},string:function(e){return this["return"](new m(e.value))},"boolean":function(e){return this["return"](F[e.value])},nil:_,unknown:_,value:function(e){return this["return"](e.value)},"pop scope":U(function(e){return this.scope=this.scope.parent}),"set scope":U(function(e){return this.scope=e.scope}),"pop call stack":U(function(){return this.callStack.pop()}),"pop catch stack":U(function(){return this.catchStack.pop()}),"ignore arguments":function(){return this.pop()},"reapply funject":function(e){return e.funject.apply(this,e.own,e.argument,e["private"],e.instance)},"native":function(e){return e.value.call(this,e)},sequence:function(e){if(this.frame["arguments"].length===0){this.scope=new v(this.scope);this.scope.isProxy=e.isProxy;this.scope.name="<sequence>";this.scope.line=e.line;this.scope.character=e.character}if(!this.args.apply(this,e.expressions)){return}this.popScope();return this["return"](N(this.frame["arguments"]))},assignment:function(t){var n;switch(t.operator){case"inverse assignment":if(!this.args(t.left,t.right)){return}this.first().inverse=this.second();return this["return"](this.first());case"inheritance assignment":if(!this.args(t.left,t.right)){return}this.first().parent=this.second();return this["return"](this.first())}if(t.left.type==="identifier"){switch(t.operator){case"strict assignment":if(!this.args(t.right)){return}this.scope.set(t.left.value,this.first());return this["return"](this.first());case"reset strict assignment":if(!this.args(t.right)){return}this.scope.reset(t.left.value,this.first());return this["return"](this.first());case"lazy assignment":this.scope.set(t.left.value,{lazy:t.right,scope:this.scope});return this["return"](F.nil);case"reset lazy assignment":this.scope.reset(t.left.value,{lazy:t.right,scope:this.scope});return this["return"](F.nil)}}if(t.left.type==="application"){if(!this.args(t.left.funject)){return}n=this.first();if(n.isInstance&&!e){throw new u("Cannot modify class definition")}if(t.operator!=="lazy assignment"&&this.frame["arguments"].length===1){this.push(t.right);return}(n.patterns!=null?n.patterns:n.patterns=[]).unshift(t.operator==="lazy assignment"?{pattern:t.left.argument,expression:t.right,scope:this.scope}:{pattern:t.left.argument,value:this.second(),scope:this.scope});return this["return"](t.operator==="lazy assignment"?F.nil:this.second())}throw new u("Unimplemented: "+t.operator)},identifier:Y,"formal parameter":Y,list:function(e){if(!this.args.apply(this,e.values)){return}return this["return"](new l(this.frame["arguments"]))},funject:function(e){var t,n;t=new i;t.expression=e;t.patterns=function(){var t,r,i,a;i=e.patterns;a=[];for(t=0,r=i.length;t<r;t++){n=i[t];a.push({pattern:n.pattern,expression:n.value,scope:this.scope})}return a}.call(this);return this["return"](t)},"if":function(e){var t,n;if(!this.args(e.condition,{type:"application",funject:{type:"value",value:this.first()},argument:{type:"symbol",value:"to-boolean"}})){return}t=this.second();if(t!==F["true"]&&t!==F["false"]){throw new u("Cannot convert "+this.first()+" to boolean")}if(!this.args(0,0,t===F["true"]?e.trueBody:(n=e.falseBody)!=null?n:{type:"nil"})){return}return this["return"](this.third())},"try":function(e){this.pop();if(e["finally"]){this.push(e["finally"]);this.push({type:"ignore arguments"})}this.catchStack.push({index:this.stack.length,callIndex:this.callStack.length,expression:e,scope:this.scope});this.push({type:"pop catch stack"});return this.push(e.body)},module:function(e){var t,n,r;r=e.parent!=null;if(r&&!this.args(e.parent)){return}t=r?1:0;if(this.frame["arguments"].length===t){this.frame["super"]=r?this.first():F.Funject;this.push({type:"pop scope"});this.scope=this.frame.scope=new v(this.scope,{exports:new i({parent:this.frame["super"]}),"super":this.frame["super"]},true);if(r){this.args(e.parent,e.body)}else{this.args(e.body)}return}n=this.frame.scope.vars.exports;n.parent=this.frame["super"];return this["return"](n)},"class":function(e){var t,n,a,s,o,c,f;if((n=this.stack[this.stack.length-2].expression)&&n.type==="assignment"&&n.left.type==="identifier"){this.frame.name=n.left.value}else{this.frame.name="<class>"}c=e.parent!=null;if(c&&!this.args(e.parent)){return}t=c?1:0;if(this.frame["arguments"].length===t){this.frame["super"]=c?this.first():F.Funject;if(!this.frame["super"].isClass){throw new u("Cannot inherit from "+this.frame["super"])}this.push({type:"pop scope"});this.scope=this.frame.scope=new v(this.scope,{exports:new r({parent:this.frame["super"],name:this.frame.name,expression:e}),"super":this.frame["super"],instance:new i({parent:this.frame["super"].$instance})},true);e.body.isProxy=true;if(c){this.args(0,e.body)}else{this.args(e.body)}return}a=this.frame.scope.vars.exports;a.parent=this.frame["super"];a.$super=this.frame["super"];a.$subclasses=new l([]);this.frame["super"].$subclasses.value.push(a);o=a.$instance=this.frame.scope.vars.instance;o.isInstance=true;o.name=""+this.frame.name+".instance";o.expression=e;o.parent=this.frame["super"].$instance;f=G(null,{"class":a});s=new i({call:["interpreter","symbol",function(e,t){var n;n=e.frame.expression;e.pop();e.push({type:"native",value:function(){var e;if(!this.args({type:"application",funject:{type:"value",value:o},argument:{type:"value",value:t}})){return}e=this.first();if(e.name==null){e.name="instance."+t.value}return this["return"](new i({call:["interpreter",["|",["*"],["*","*"]],function(t,r,a){t.pop();t.pop();t.callStack.pop();t.push({type:"application",file:n!=null?n.file:void 0,line:n!=null?n.line:void 0,character:n!=null?n.character:void 0,funject:{type:"value",value:e},argument:{type:"value",value:new l(a?[r,a]:[r])},"private":r["private"]!=null?r["private"]:r["private"]=new i});return h}]}))}});return h}]});(a.call!=null?a.call:a.call=[]).unshift(".instance",function(){return s},"interpreter",".new",function(e){var t;t=e.frame.expression;e.pop();e.pop();e.callStack.pop();e.push({type:"native",value:function(){var e,n,r,a;r={type:"application",file:t!=null?t.file:void 0,line:t!=null?t.line:void 0,character:t!=null?t.character:void 0,instance:false,funject:{type:"value",value:o},argument:{type:"symbol",value:"initialize"}};if(!this.args(r)){return}n=this.first();if(n.name==null){n.name="instance.initialize"}e=n.methodHasArgs();a=new i({parent:f,instance:o});if(e){return this["return"](new i({call:["interpreter","*",function(e,r){e.pop();e.push({type:"value",value:a});e.push({type:"application",file:t!=null?t.file:void 0,line:t!=null?t.line:void 0,character:t!=null?t.character:void 0,"private":a["private"]!=null?a["private"]:a["private"]=new i,funject:{type:"value",value:n},argument:{type:"value",value:new l([a,r])}});return h}]}))}else{this.pop();this.push({type:"value",value:a});return this.push({type:"application",file:t!=null?t.file:void 0,line:t!=null?t.line:void 0,character:t!=null?t.character:void 0,"private":a["private"]!=null?a["private"]:a["private"]=new i,funject:{type:"value",value:n},argument:{type:"value",value:new l([a])}})}}});return h});return this["return"](a)},application:function(e){var t,n,r;if(!this.args(e.funject,e.argument)){return}if(this.frame["arguments"].length>2){return this["return"](this.frame["arguments"][2])}n=this.first();t=this.second();this.stack.splice(this.stack.length-1,0,{expression:{type:"pop call stack"},arguments:[]});this.callStack.push({expression:e,name:n.name});return n.apply(this,(r=e.own)!=null?r:n,t,e["private"],e.instance)},or:P,and:P};t.prototype.load=function(e){this.scope=E;this.stack=[{arguments:[]}];this.callStack=[];this.catchStack=[];e.isProxy=true;this.push(e);return this};t.prototype.evaluate=function(e){this.load(e);while(this.stack.length>1){this.step()}return N(this.stack[0]["arguments"])};t.prototype.step=function(e){var t,n,r,i,a;if(this.stack.length===1){return true}this.frame=N(this.stack);try{this.expression()}catch(s){n=s;if(n instanceof u||n instanceof g){r=(a=n.error)!=null?a:this.createError(n.message);while(this.catchStack.length){t=this.catchStack.pop();try{i=t.scope.get(t.expression["class"].value)}catch(s){}if(i&&r.isKindOf(i)){this.stack=this.stack.slice(0,+(t.index-1)+1||9e9);this.callStack=this.callStack.slice(0,+(t.callIndex-1)+1||9e9);if(t.expression.name){this.scope=new v(t.scope);this.scope.set(t.expression.name.value,r)}else{this.scope=t.scope}this.push(t.expression["catch"]);return}}throw new p(r.value,r.value+"\n"+r.stack)}else{if(typeof require!=="undefined"&&require!==null){console.log(require("util").inspect(this.stack,{depth:5}))}throw n}}return false};t.prototype.stackTrace=function(){var e,t,n,r,i,a,u,s;i="";e=this.callStack.slice(0);e.push({expression:this.frame.expression});r=null;for(a=0,u=e.length;a<u;a++){s=e[a],t=s.expression,n=s.name;if(r){if(t.file){i="\n at "+r+" ("+t.file+":"+t.line+":"+t.character+")"+i}else{i="\n at "+r+i}}else{if(t.file){i="\n at "+t.file+":"+t.line+":"+t.character+i}else{i="\n at <anonymous>"+i}}r=n}return i.substr(1)};t.prototype.createError=function(e){var t;t=F.Error.create();t.value=e;t.stack=this.stackTrace();return t};t.prototype.value=function(){return N(this.stack[0]["arguments"])};t.prototype.arg=function(e,t){var n,r;if(e>this.frame["arguments"].length){throw new TypeError("Invalid arg(..) offset "+e)}if(e===this.frame["arguments"].length){this.push(t);return false}if((n=this.frame["arguments"][e]).lazy){this.frame["arguments"].pop();r=this.scope;this.push({type:"set scope",scope:r});this.scope=n.scope;this.push(n.lazy);return false}return true};t.prototype.args=function(){var e,t;e=1<=arguments.length?it.call(arguments,0):[];t=this.frame["arguments"].length;if(t&&this.frame["arguments"][t-1].lazy){this.arg(t-1,e[t-1]);return false}if(t<e.length){this.push(e[t]);return false}return true};t.prototype.expression=function(){var e;e=this.frame.expression;if(this.expressions[e.type]==null){throw new Error("Invalid expression type "+e.type)}return this.expressions[e.type].call(this,e)};t.prototype["return"]=function(e){this.stack.pop();return N(this.stack)["arguments"].push(e)};t.prototype.push=function(e){return this.stack.push({expression:e,arguments:[]})};t.prototype.pop=function(){return this.stack.pop()};t.prototype.popScope=function(){return this.scope=this.scope.parent};t.prototype.first=function(e){return this.frame["arguments"][0]};t.prototype.second=function(e){return this.frame["arguments"][1]};t.prototype.third=function(e){return this.frame["arguments"][2]};return t}();S=function(e,t,n){return(new a).evaluate(B.parse(e,t,n))};o=1e3;j=function(e,t,n,r){var i,u,s,l,c,f,h,v;if(t==null){t="<anonymous>"}if(n==null){n=1}if(r==null){r=null}i=[];u=[];l=[];f=function(e,t){var n,r,a,s,o,c,f,p;for(r=0,o=i.length;r<o;r++){n=i[r];n(e,t)}if(t){for(a=0,c=u.length;a<c;a++){n=u[a];n(t)}}if(e){p=[];for(s=0,f=l.length;s<f;s++){n=l[s];p.push(n(e))}return p}};if(arguments.length===2){r=t;t="<anonymous>"}if(r){i.push(r)}try{c=(new a).load(B.parse(e,t,n));v=setTimeout(h=function(){var e,t;t=0;try{while(true){if(c.step()){f(null,c.value());return}else if(++t>=o){v=setTimeout(h);return}}}catch(n){e=n;if(e instanceof p){return f(e,null)}else{throw e}}})}catch(m){s=m;if(s instanceof SyntaxError){setTimeout(function(){return f(s,null)})}else{throw s}}return{abort:function(){clearTimeout(v);return this},then:function(e){i.push(e);return this},done:function(e){u.push(e);return this},fail:function(e){l.push(e);return this}}};H=function(){var e,t,n,r,i,a,u,s,l;r=require("readline");u=r.createInterface({input:process.stdin,output:process.stdout,completer:function(e){var t;if(/^\s*$/.test(e)){if(t=/(^|\n)([ \t]+).*\n$/.exec(n)){if(e.length>=t[2].length){return[[e+"    "],e]}else{return[[t[2]],e]}}else{return[[e+"    "],e]}}else{return[[],e]}}});e=4;i=1;s=function(t){var n;if(t==null){t=">"}n=""+i;while(n.length<e){n="0"+n}return u.setPrompt(n+t+" ")};s(">");u.prompt();n="";t=1;l=0;a=null;u.on("line",function(e){++i;l=0;if(e===""&&n===""){s(">");u.prompt();t=i;return}n+=e+"\n";if(!/^[\t ]|(^|[(\[])(class|module|try|catch|finally|if|else)\b|\[[^\]]*$|\([^)]*$|\{[^\}]*$/.test(e)){return a=j(n,"input",t,function(e,r){if(e){if(e.trace){console.log(e.trace)}else if(e.message){console.log(e.message)}}else if(r){console.log(r.toSource(3))}a=null;n="";t=i;s(">");return u.prompt()})}else{s(":");return u.prompt()}});u.on("SIGINT",function(){if(a!=null){a.abort();n=""}else{u._refreshLine();if(u.line===""&&n===""){if(l){u.close()}else{l=1;u.clearLine();console.log("(^C again to quit)")}}else{l=0;u.clearLine();n=""}}++i;t=i;s(">");return u.prompt()});return u.on("close",function(){console.log("");return process.exit(0)})};if(typeof module!=="undefined"&&module!==null){C=require("fs");A=require("path");B=require("./parser.coffee");V=exports;V.repl=H;if(!module.parent){O=[];$=2;q=1;b=process.argv.length;z=false;while($<b){switch(w=process.argv[$++]){case"-h":console.error("Usage: coffee interpreter.coffee [ <filename> | -e <expression> | -i | -h ]");return;case"-i":z=true;break;case"--allow-class-redefinition":e=true;break;case"-e":O.push({file:"expression"+q++,source:process.argv[$++]});break;default:O.push({file:A.resolve(w),source:""+C.readFileSync(w)})}}for(Q=0,Z=O.length;Q<Z;Q++){M=O[Q];try{S(M.source,M.file)}catch(at){d=at;if(d instanceof SyntaxError){console.error(d.message)}else{throw d}}}if(z||O.length===0){H()}}}else{B=Yak.parser;(this.Yak!=null?this.Yak:this.Yak={}).interpreter=V={}}V["eval"]=j;V.evalSync=S}.call(this);!function(){var e,t,n,r,i,a,u,s,l,o,c,f,p,h,v,m,y,g;u=document.querySelector("header");m=document.querySelector(".header-fill");a=document.querySelectorAll("h1");f=u.firstElementChild;o=document.querySelectorAll("nav a");g=document.querySelector(".try-yak");s=document.querySelector(".interpreter");p=document.querySelector(".prompt");y=document.querySelector(".prompt textarea");c=document.querySelector(".prompt .measure");s.style.display="block";u.style.position="fixed";u.style.left="24px";u.style.right="24px";h=function(){return m.style.height=u.offsetHeight+"px"};window.addEventListener("resize",h);h();r=false;t=void 0;e={};v=function(n){var i,l,c,p,h,v,m,y;v=f.lastElementChild.offsetHeight-f.offsetHeight;h=s.offsetHeight;m=v+h;if(r){v=m}y=Math.min(0,Math.max(v,-window.scrollY));if(n===e){u.style.transition="top .3s";setTimeout(function(){return u.style.transition="none"},300)}u.style.top=y+"px";if(t){t.className=""}g.style.display=y<=m?"block":"none";
c=0;l=a[0];while(c<a.length){i=a[c].getBoundingClientRect();if(i.top>96+(r?h:0)){break}l=a[c];++c}p=l.nextElementSibling.id;c=0;while(c<o.length){if(o[c].href.split("#").pop()===p){t=o[c];break}++c}return t.className="active"};window.addEventListener("scroll",v);v();g.addEventListener("click",function(){if(!r){r=true;setTimeout(function(){return i()},300);v(e);return g.textContent="Close"}else{r=false;v(e);return g.textContent="Try Yak"}});i=function(){y.focus();return y.selectionStart=y.selectionEnd=y.value.length};if(y.getBoundingClientRect().top>=0){i()}n=function(){c.textContent=y.value+"X";return y.style.height=c.offsetHeight+"px"};y.addEventListener("input",n);n();l=function(e){var t,r,i,a,u,l,o,c;a=function(e){var n;n=r+e;y.value=n+t;return y.selectionStart=y.selectionEnd=n.length};l=function(e,t){var n;n=document.createElement("div");n.className=e;n.textContent=t;s.insertBefore(n,p);return s.scrollTop=s.scrollHeight};r=y.value.slice(0,y.selectionStart);t=y.value.slice(y.selectionStart);u=r.split("\n").pop();i=/^\s*/.exec(u)[0];switch(e.keyCode){case 13:e.preventDefault();c=/class|module|if|else|try|catch|finally|\[[^\]]*$|\([^\)]*$|\{[^\}]*$/.test(u);if(e.shiftKey||y.selectionStart!==y.selectionEnd||y.selectionStart!==y.value.length||i.length!==0||c){if(c){i+="    "}a("\n"+i)}else{l("prompt",y.value);if(y.value){Yak.interpreter["eval"](y.value,"input",1,function(e,t){var n;if(e){return l("error",(n=e.trace)!=null?n:e.message)}else if(t){return l("output",t.toSource())}});y.value=""}}return n();case 9:e.preventDefault();if(e.shiftKey){o=Math.min(u.length-Math.ceil(u.length/4-1)*4,/\s*$/.exec(r)[0].length);if(o){r=r.slice(0,-o);return a("")}}else{return a(Array(Math.floor(u.length/4+1)*4-u.length+1).join(" "))}}};y.addEventListener("keydown",l)}.call(this);